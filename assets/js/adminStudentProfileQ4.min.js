var studentForSearch=[];const getDateName=a=>{return["SUN","MON","TUE","WED","THU","FRI","SAT"][a]},getLetterGrade=a=>{return 6>=a?"P"+a:"S"+(a-6)};function getStudentProfile(){let a=getCookieDict(),b=a.monkeyWebAdminAllstudentSelectedUser;document.getElementById("studentID").innerHTML="ID: "+b,showProfilePic(),showReceipt(),studentProfile(b).then(c=>{log("[getStudentProfile()] : post/studentProfile => "),log(c),document.getElementById("studentName").innerHTML=c.firstname+" ("+c.nickname+") "+c.lastname,document.getElementById("studentNameEng").innerHTML=c.firstnameEn+" ("+c.nicknameEn+") "+c.lastnameEn,document.getElementById("studentLevel").innerHTML="Grade: "+getLetterGrade(c.grade),document.getElementById("email").innerHTML="e-mail: "+c.email,document.getElementById("phone").innerHTML="phone: "+c.phone,document.getElementById("studentLevel").innerHTML="Level: "+c.level;for(let d=0;d<c.quarter.length;d++)log(c.quarter[d]),2017===c.quarter[d].year&&4===c.quarter[d].quarter&&(courseStage=c.quarter[d].registrationState);if(void 0!==courseStage)switch(document.getElementById("studentStateCr").innerHTML="STAGE CR: "+courseStage,courseStage){case"approved":document.getElementById("approveBtn").className+=" disabled";break;case"rejected":document.getElementById("rejectBtn").className+=" disabled";break;case"pending":document.getElementById("approveBtn").className+=" disabled",document.getElementById("rejectBtn").className+=" disabled",document.getElementById("pendingBtn").className+=" disabled";break;case"finished":document.getElementById("approveBtn").className+=" disabled",document.getElementById("rejectBtn").className+=" disabled",document.getElementById("finishedBtn").className+=" disabled";break;default:}document.getElementById("studentStatus").innerHTML="STATUS: "+c.status,$.post("post/v1/studentTimeTable",{quarter:4,year:2017,studentID:b}).then(d=>{console.log(d);for(let f=0;f<d.course.length;f++)document.getElementById(d.course[f].day).innerHTML=d.course[f].courseName+" -  "+d.course[f].tutorName,document.getElementById(d.course[f].day).value=d.course[f].courseID,document.getElementById(d.course[f].day).className="btn btn-warning col-sm-12";for(let f=0;f<d.hybrid.length;f++){let g=new Date(parseInt(d.hybrid[f].day)),h=moment(0).day(0===g.getDay()?7:g.getDay()).hour(g.getHours()).valueOf();var e=document.getElementById(h);e===void 0&&(e=document.getElementById(d.hybrid[f].day)),e.innerHTML="FHB : "+d.hybrid[f].subject,e.value=d.hybrid[f].hybridID,e.className="btn btn-primary col-sm-12"}for(let f=0;f<d.skill.length;f++){let g=new Date(parseInt(d.skill[f].day)),h=new Date(parseInt(d.skill[f].day));h.setMinutes(0),(9===h.getHours()||11===h.getHours()||14===h.getHours()||16===h.getHours())&&h.setHours(h.getHours()-1);let j=moment(0).day(0===h.getDay()?7:h.getDay()).hour(h.getHours()).valueOf();var e=document.getElementById(j);e===void 0&&(e=document.getElementById(h.valueOf())),document.getElementById(j).innerHTML="SKILL : "+d.skill[f].subject+" "+g.getHours()+":"+(0===g.getMinutes()?"00":g.getMinutes()),document.getElementById(j).value=d.skill[f].skillID,document.getElementById(j).className="btn btn-info col-sm-12"}genCover(b,c,c.grade,d)})})}function addRemoveCourse(a){let b=document.getElementById(a);"Add Course"===b.innerHTML?$.post("post/v1/listSubjectInQuarter",{quarter:4,year:2017,day:a}).then(c=>{let d=document.getElementById("courseSelector");for(let f=0;f<c.course.length;f++)d.innerHTML+="<option id='"+c.course[f].courseID+"'>"+c.course[f].courseName+" - "+c.course[f].tutorName+"</option>";for(let f=0;f<c.hybrid.length;f++)d.innerHTML+="<option id='"+c.hybrid[f].hybridID+"' value='M'>FHB : M</option>",d.innerHTML+="<option id='"+c.hybrid[f].hybridID+"' value='P'>FHB : P</option>";for(let f=0;f<c.skill.length;f++){var e=new Date(c.skill[f].day);d.innerHTML+="<option id='"+c.skill[f].skillID+"' value='M'>SKILL Math "+e.getHours()+":"+(0===e.getMinutes()?"00":e.getMinutes())+"</option>",d.innerHTML+="<option id='"+c.skill[f].skillID+"' value='E'>SKILL English "+e.getHours()+":"+(0===e.getMinutes()?"00":e.getMinutes())+"</option>",d.innerHTML+="<option id='"+c.skill[f].skillID+"' value='ME'>SKILL English and Math "+e.getHours()+":"+(0===e.getMinutes()?"00":e.getMinutes())+"</option>"}$("#addModal").modal()}):(document.getElementById("confirmDelete").value=b.value,document.getElementById("courseName").innerHTML=b.innerHTML,document.getElementById("removeModal").value=a,$("#removeModal").modal())}function removeCourse(){let a=getCookieDict(),b=a.monkeyWebAdminAllstudentSelectedUser,c=document.getElementById("confirmDelete"),d=c.value,e=document.getElementById("courseName").innerHTML,f=parseInt(document.getElementById("removeModal").value);"SKILL"===e.slice(0,5)?$.post("post/v1/removeSkillStudent",{studentID:b,skillID:d}).then(()=>{location.reload()}):"FHB"===e.slice(0,3)?$.post("post/v1/removeHybridStudent",{studentID:b,hybridID:d}).then(()=>{location.reload()}):removeStudentCourse(b,[d]).then(g=>{g.err?log("[RemoveCourse()] : post/removeStudentCourse => "+g.err):(log("[RemoveCourse()] : post/removeStudentCourse => Success"),location.reload())})}function addCourse(){let a=getCookieDict(),b=a.monkeyWebAdminAllstudentSelectedUser,c=document.getElementById("courseSelector"),d=c.options[c.selectedIndex],e=d.innerHTML,f=d.value,g=d.id;if(console.log(g),console.log(f),console.log(e),"SKILL"===e.slice(0,5))$.post("post/v1/addSkillStudent",{skillID:g,subject:f,studentID:b}).then(h=>{h.err?log("[addCourse()] : post/v1/addSkillStudent => "+h.err):(log("[addCourse()] : post/v1/addSkillStudent => Success"),location.reload())});else if("FHB"===e.slice(0,3))$.post("post/v1/addHybridStudent",{hybridID:g,subject:f,studentID:b}).then(h=>{h.err?log("[addCourse()] : post/v1/addHybridStudent => "+h.err):(log("[addCourse()] : post/v1/addHybridStudent => Success"),location.reload())});else{let h=d.id;addStudentCourse(b,[h]).then(j=>{j.err?log("[addCourse()] : post/addStudentCourse => "+j.err):(log("[addCourse()] : post/addStudentCourse => Success"),location.reload())})}}function setRegistrationState(a,b){let c=parseInt(document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length));var d;switch(b){case"quarter":d={year:2017,quarter:4};break;default:}log(d),changeRegistrationState(c,a,d).then(e=>{e.err&&log("[setRegistrationState()] : post/changeRegistrationState => "+e.err),location.reload()})}function showProfilePic(){let a=$("#studentID").html().slice(4);$.post("post/getConfig").then(b=>{let c=b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+a;$.get(c+".jpg").done(function(){$("#profilePic").attr("src",c+".jpg")}).fail(function(){$.get(c+".jpeg").done(function(){$("#profilePic").attr("src",c+".jpeg")}).fail(function(){$.get(c+".png").done(function(){$("#profilePic").attr("src",c+".png")}).fail(function(){log("can't find profile picture")})})})})}function showReceipt(){let a=$("#studentID").html().slice(4);$.post("post/getConfig").then(b=>{let c=b.receiptPath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+"CR60Q4/"+a;log(c),$.get(c+".jpg").done(function(){$("#imgTrans").attr("src",c+".jpg")}).fail(function(){$.get(c+".jpeg").done(function(){$("#imgTrans").attr("src",c+".jpeg")}).fail(function(){$.get(c+".png").done(function(){$("#imgTrans").attr("src",c+".png")}).fail(function(){log("can't find profile picture")})})})})}function upPic(){let a=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length),b=$("#file-1"),c=b.val().split(".").pop().toLowerCase();if(-1===$.inArray(c,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let d=b.get(0).files,e=new FormData;e.append("file",d[0],d[0].name),e.append("userID",a),$.ajax({url:"post/updateProfilePicture",type:"POST",data:e,processData:!1,contentType:!1,success:function(){showProfilePic(),$("#profileModal").modal("hide")}})}}function upReciept(){let a=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length),b=$("#file-2"),c=b.val().split(".").pop().toLowerCase();if(-1===$.inArray(c,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let d=b.get(0).files,e=new FormData;e.append("file",d[0],d[0].name),e.append("studentID",a),e.append("year",2017),e.append("quarter",4),$.ajax({url:"post/submitReceipt",type:"POST",data:e,processData:!1,contentType:!1,success:function(){$("#rcModal").modal("hide"),location.reload()}})}}function genCover(a,b,c,d){barcode(a);let e=!1,f=!1;for(let h in log(d),d.hybrid)"M"==d.hybrid[h].subject&&(e=!0),"PH"==d.hybrid[h].subject&&(f=!0),"P"==d.hybrid[h].subject&&(f=!0);for(let h in d.course)"Hybrid"==d.course[h].tutorName&&("M"==d.course[h].courseName.slice(0,1)?e=!0:f=!0);e||($("#math").addClass("disabled"),$("#math").prop("disabled",!0)),f||($("#phy").addClass("disabled"),$("#phy").prop("disabled",!0));let g="";e&&(g+="m"),f&&(g+="p"),g+=6<c?"h":"j",$("#tableTemplate").attr("src","images/"+g+".png"),e&&fillCover(a,b,c,"math",d),f&&fillCover(a,b,c,"phy",d)}function barcode(a){JsBarcode("#mathBarcode",a+"1",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#phyBarcode",a+"2",{lineColor:"black",width:3.4,height:68,displayValue:!1})}function fillCover(a,b,c,d,e){let g=document.getElementById(d+"Canvas"),h=g.getContext("2d"),j=document.getElementById("tableTemplate");h.drawImage(j,0,0,1654,1170),h.font="bold 150px Cordia New",h.fillText(getLetterGrade(c),55,128);let k=document.getElementById(d+"Barcode");h.drawImage(k,430,115);let l=document.getElementById("profilePic"),m=184,n=l.width*m/l.height;h.drawImage(l,205,30,n,m),h.font="bold 70px Cordia New","math"===d?h.fillText("ID: "+a+"1",445,84):h.fillText("ID: "+a+"2",445,84);let o=18<(b.firstname+b.nickname).length?b.firstname:b.firstname+" ("+b.nickname+")",q=18<(b.firstname+b.nickname).length?"("+b.nickname+") "+b.lastname:b.lastname;h.font="bold 75px Cordia New",h.textAlign="center",h.fillText(o,930,94),h.fillText(q,930,180),h.textBaseline="middle",h.font="bold 55px Cordia New";const r=[324,568,812,1056],s=[386,514,642,770,898],t=[448,576,704,832,960],u=[1342,1420,1498,1576],v=[144,218,292,366,440],w=z=>{let A=[0,0];switch(moment(z).day()){case 0:A[0]=3;break;case 2:A[0]=0;break;case 4:A[0]=1;break;case 6:A[0]=2;break;default:}switch(moment(z).hour()){case 8:A[1]=0;break;case 10:A[1]=1;break;case 13:A[1]=2;break;case 15:A[1]=3;break;case 17:A[1]=4;break;default:}return A},x=z=>{let A=[0,0];switch(moment(z).day()){case 0:A[0]=3;break;case 2:A[0]=0;break;case 4:A[0]=1;break;case 6:A[0]=2;break;default:}switch(moment(z).hour()){case 8:A[1]=0;break;case 9:A[1]=0;break;case 10:A[1]=1;break;case 11:A[1]=1;break;case 12:A[1]=1;break;case 13:A[1]=2;break;case 14:A[1]=2;break;case 15:A[1]=3;break;case 16:A[1]=3;break;default:}return A};for(let z in e.course){let A=w(e.course[z].day);h.fillText("CR : "+e.course[z].courseName,r[A[0]],s[A[1]]),h.fillText("Hybrid"==e.course[z].tutorName?"HB":e.course[z].tutorName,r[A[0]],t[A[1]]),"Hybrid"==e.course[z].tutorName&&d.slice(0,1).toLowerCase()==e.course[z].courseName.slice(0,1).toLowerCase()&&h.fillText("CR",u[A[0]],v[A[1]])}for(let z in e.hybrid){let A=w(e.hybrid[z].day);h.fillText("FHB : "+("M"==e.hybrid[z].subject?"M":"P"),r[A[0]],s[A[1]]),h.fillText("HB",r[A[0]],t[A[1]]),log(d.slice(0,1).toLowerCase()==e.hybrid[z].subject.slice(0,1).toLowerCase()),d.slice(0,1).toLowerCase()==e.hybrid[z].subject.slice(0,1).toLowerCase()&&h.fillText("HB",u[A[0]],v[A[1]])}let y=0;for(let z in e.skill){let A=x(e.skill[z].day);moment(e.skill[z].day).hour()==y?(h.fillStyle="white",9==moment(e.skill[z].day).hour()||11==moment(e.skill[z].day).hour()||14==moment(e.skill[z].day).hour()||16==moment(e.skill[z].day).hour()?(h.fillRect(r[A[0]]-120,t[A[1]]-30,235,50),h.fillStyle="black",h.fillText("SK : "+moment(e.skill[z].day).format("H:00"),r[A[0]],t[A[1]])):(h.fillRect(r[A[0]]-120,s[A[1]]-30,235,50),h.fillStyle="black",h.fillText("SK : "+moment(e.skill[z].day).format("H:00"),r[A[0]],s[A[1]]))):9==moment(e.skill[z].day).hour()||11==moment(e.skill[z].day).hour()||14==moment(e.skill[z].day).hour()||16==moment(e.skill[z].day).hour()?h.fillText("SK : "+e.skill[z].subject+" "+moment(e.skill[z].day).format("H:mm"),r[A[0]],t[A[1]]):h.fillText("SK : "+e.skill[z].subject+" "+moment(e.skill[z].day).format("H:mm"),r[A[0]],s[A[1]]),y=moment(e.skill[z].day).hour()}}