var stdCourse=[],stdHybrid=[],stdSkill=[];$(document).ready(function(){let a=getCookieDict(),b=a.monkeyWebUser;$("#datePicker").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[1,3,5],minDate:moment()}),$("#datePicker").on("dp.change",function(){$(".selector").html("-").addClass("blank btn-default").removeClass("cr hb sk btn-success");let d=$("#datePicker").data("DateTimePicker").date();2===d.day()||4===d.day()?($(".btn8").html("17-19"),fillHybrid(1)):($(".btn8").html("8-10"),$(".btn10").html("10-12"),$(".btn13").html("13-15"),$(".btn15").html("15-17"),fillCourse(),fillHybrid(0),fillSkill())}),$("#typeInput").change(function(){$(".selector").removeClass("btn-success").addClass("btn-default"),chkState()}),$(".selector").click(function(){$(this).hasClass("disabled")||($(".selector").removeClass("btn-success").addClass("btn-default"),$(this).toggleClass("btn-default btn-success"))}),$("#submit").click(function(){0<$(".btn-success").length?$("#senderInput").val()?sendRequest(b):alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E1C\u0E39\u0E49\u0E41\u0E08\u0E49\u0E07"):alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E23\u0E2D\u0E1A\u0E17\u0E35\u0E48\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E32")}),$(".selector").html("-").addClass("blank").removeClass("cr hb sk");let c=$("#datePicker").data("DateTimePicker").date();2===c.day()||4===c.day()?$(".btn8").html("17-19"):($(".btn8").html("8-10"),$(".btn10").html("10-12"),$(".btn13").html("13-15"),$(".btn15").html("15-17")),studentProfile(b).then(d=>{let e=[];for(let f in d.courseID)e.push(courseInfo(d.courseID[f]));Promise.all(e).then(f=>{stdCourse=f.filter(function(g){return g.quarter===presentQuarter&&g.year===year}),fillCourse()})}),listStudentHybrid(year,presentQuarter,b).then(d=>{stdHybrid=d;let e=$("#datePicker").data("DateTimePicker").date();2===e.day()||4===e.day()?fillHybrid(1):fillHybrid(0)}),listStudentSkill(year,presentQuarter,b).then(d=>{stdSkill=d,fillSkill()})});function fillCourse(){let a=$("#datePicker").data("DateTimePicker").date();for(let c,b=0;b<stdCourse.length;b++)c=stdCourse[b],moment(c.day).day()===a.day()&&$(".btn"+moment(c.day).hour()).html("CR:"+c.courseName).removeClass("blank").addClass("cr");chkState()}function fillHybrid(a){let b=$("#datePicker").data("DateTimePicker").date();for(let d,c=0;c<stdHybrid.length;c++)d=stdHybrid[c],0===a?moment(d.day).day()===b.day()&&$(".btn"+moment(d.day).hour()).html("FHB:"+d.subject).removeClass("blank").addClass("hb").attr("id",d.hybridID):moment(d.day).day()===b.day()&&$(".btn8").html("FHB:"+d.subject).removeClass("blank").addClass("hb").attr("id",d.hybridID);chkState()}function fillSkill(){let a=$("#datePicker").data("DateTimePicker").date();for(let c,b=0;b<stdSkill.length;b++)c=stdSkill[b],moment(c.day).day()===a.day()&&(9>=moment(c.day).hour()?$(".btn8").html("SKILL").removeClass("blank").addClass("sk"):12>=moment(c.day).hour()?$(".btn10").html("SKILL").removeClass("blank").addClass("sk"):14>=moment(c.day).hour()?$(".btn13").html("SKILL").removeClass("blank").addClass("sk"):$(".btn15").html("SKILL").removeClass("blank").addClass("sk"));chkState()}function chkState(){let a=$("#datePicker").data("DateTimePicker").date();2===a.day()||4===a.day()?0==$("#typeInput").val()?($(".blank,.sk,.cr").addClass("disabled"),$(".hb").removeClass("disabled")):($(".hb,.sk,.cr,.blank").addClass("disabled"),$(".btn8").removeClass("disabled")):0==$("#typeInput").val()?($(".blank,.sk,.cr").addClass("disabled"),$(".hb").removeClass("disabled")):($(".blank").removeClass("disabled"),$(".hb,.sk,.cr").addClass("disabled"))}function sendRequest(a){name(a).then(b=>{let c="\n"+b.nickname+" "+b.firstname;$("#loaderModal").modal();let d=$("#datePicker").data("DateTimePicker").date();if("0"===$("#typeInput").val()){c+="\n\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21\u0E15\u0E25\u0E2D\u0E14\u0E44\u0E1B:\n"+$(".btn-success").html()+" - ";let e=$(".btn-success").attr("id"),f=$("#datePicker").data("DateTimePicker").date().hour(7);c+=f.format("ddd DD/MM/YYYY"),c+="\n\u0E1C\u0E39\u0E49\u0E41\u0E08\u0E49\u0E07:"+$("#senderInput").val(),$.post("post/v1/removeHybridStudentOnTime",{hybridID:e,studentID:a,date:f.valueOf()}).then(g=>{log(g),log("finish to remove"),$.post("post/lineNotify",{recipient:"MonkeyAdmin",message:c},()=>{location.reload()})})}else{let e=$(".btn-success").html();d.hour(e.slice(0,e.indexOf("-")));let f=$("#subjInput").val();c+="\n\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E32\u0E15\u0E25\u0E2D\u0E14\u0E44\u0E1B:\nFHB:"+$("#subjInput").val()+" - ";let g=d;c+=g.format("ddd DD/MM/YYYY HH:00"),c+="\n\u0E1C\u0E39\u0E49\u0E41\u0E08\u0E49\u0E07:"+$("#senderInput").val(),g=g.minute(g.minute()+2),$.post("post/v1/listHybridDayInQuarter",{year:year,quarter:presentQuarter}).then(h=>{for(let j in h)if(moment(h[j].day).day()===d.day()&&moment(h[j].day).hour()===d.hour()){let k=h[j].hybridID;$.post("post/v1/addHybridStudentOnTime",{hybridID:k,studentID:a,subject:f,date:g.valueOf()}).then(l=>{log(l),log("finish to add"),$.post("post/lineNotify",{recipient:"MonkeyAdmin",message:c},()=>{location.reload()})})}})}})}