var stdCourse=[],stdHybrid=[],stdSkill=[];$(document).ready(function(){let a=getCookieDict(),b=a.monkeyWebUser;$("#datePicker").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[1,3,5],minDate:moment()}),$("#datePicker").on("dp.change",function(){$(".selector").html("-").addClass("blank btn-default").removeClass("cr hb sk btn-success");let d=$("#datePicker").data("DateTimePicker").date();2===d.day()||4===d.day()?($(".btn8").html("17-19"),fillHybrid(1)):($(".btn8").html("8-10"),$(".btn10").html("10-12"),$(".btn13").html("13-15"),$(".btn15").html("15-17"),fillCourse(),fillHybrid(0),fillSkill())}),$("#typeInput").change(function(){$(".selector").removeClass("btn-success").addClass("btn-default"),chkState()}),$(".selector").click(function(){$(this).hasClass("disabled")||($(".selector").removeClass("btn-success").addClass("btn-default"),$(this).toggleClass("btn-default btn-success"))}),$("#submit").click(function(){0<$(".btn-success").length?$("#senderInput").val()?sendRequest(b):alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E1C\u0E39\u0E49\u0E41\u0E08\u0E49\u0E07"):alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E23\u0E2D\u0E1A\u0E17\u0E35\u0E48\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E32")}),$(".selector").html("-").addClass("blank").removeClass("cr hb sk");let c=$("#datePicker").data("DateTimePicker").date();2===c.day()||4===c.day()?$(".btn8").html("17-19"):($(".btn8").html("8-10"),$(".btn10").html("10-12"),$(".btn13").html("13-15"),$(".btn15").html("15-17")),studentProfile(b).then(d=>{let e=[];for(let f in d.courseID)e.push(courseInfo(d.courseID[f]));Promise.all(e).then(f=>{stdCourse=f.filter(function(g){return g.quarter===presentQuarter&&g.year===year}),fillCourse()})}),listStudentHybrid(year,presentQuarter,b).then(d=>{stdHybrid=d;let e=$("#datePicker").data("DateTimePicker").date();2===e.day()||4===e.day()?fillHybrid(1):fillHybrid(0)}),listStudentSkill(year,presentQuarter,b).then(d=>{stdSkill=d,fillSkill()})});function fillCourse(){let a=$("#datePicker").data("DateTimePicker").date();for(let c,b=0;b<stdCourse.length;b++)c=stdCourse[b],moment(c.day).day()===a.day()&&$(".btn"+moment(c.day).hour()).html("CR:"+c.courseName).removeClass("blank").addClass("cr");chkState()}function fillHybrid(a){let b=$("#datePicker").data("DateTimePicker").date();for(let d,c=0;c<stdHybrid.length;c++)d=stdHybrid[c],0===a?moment(d.day).day()===b.day()&&$(".btn"+moment(d.day).hour()).html("FHB:"+d.subject).removeClass("blank").addClass("hb").attr("id",d.hybridID):moment(d.day).day()===b.day()&&$(".btn8").html("FHB:"+d.subject).removeClass("blank").addClass("hb").attr("id",d.hybridID);chkState()}function fillSkill(){let a=$("#datePicker").data("DateTimePicker").date();for(let c,b=0;b<stdSkill.length;b++)c=stdSkill[b],moment(c.day).day()===a.day()&&(9>=moment(c.day).hour()?$(".btn8").html("SKILL").removeClass("blank").addClass("sk"):12>=moment(c.day).hour()?$(".btn10").html("SKILL").removeClass("blank").addClass("sk"):14>=moment(c.day).hour()?$(".btn13").html("SKILL").removeClass("blank").addClass("sk"):$(".btn15").html("SKILL").removeClass("blank").addClass("sk"));chkState()}function chkState(){let a=$("#datePicker").data("DateTimePicker").date();2===a.day()||4===a.day()?0==$("#typeInput").val()?($(".blank,.sk,.cr").addClass("disabled"),$(".hb").removeClass("disabled")):($(".hb,.sk,.cr,.blank").addClass("disabled"),$(".btn8").removeClass("disabled")):0==$("#typeInput").val()?($(".blank,.sk,.cr").addClass("disabled"),$(".hb").removeClass("disabled")):($(".blank").removeClass("disabled"),$(".hb,.sk,.cr").addClass("disabled"))}function sendRequest(a){$("#loaderModal").modal();let b=$("#datePicker").data("DateTimePicker").date();if("0"===$("#typeInput").val()){let c=$(".btn-success").attr("id"),d=$("#datePicker").data("DateTimePicker").date().hour(7);$.post("post/v1/removeHybridStudentOnTime",{hybridID:c,studentID:a,date:d.valueOf()}).then(e=>{log(e),log("finish to remove"),location.reload()})}else{let c=$(".btn-success").html();b.hour(c.slice(0,c.indexOf("-")));let d=$("#subjInput").val(),e=b;e=e.minute(e.minute()+2),$.post("post/v1/listHybridDayInQuarter",{year:year,quarter:presentQuarter}).then(f=>{for(let g in f)if(moment(f[g].day).day()===b.day()&&moment(f[g].day).hour()===b.hour()){let h=f[g].hybridID;$.post("post/v1/addHybridStudentOnTime",{hybridID:h,studentID:a,subject:d,date:e.valueOf()}).then(j=>{log(j),log("finish to add")})}})}}