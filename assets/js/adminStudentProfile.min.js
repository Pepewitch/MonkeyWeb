let loadProfileImg=(()=>{var c=_asyncToGenerator(function*(){let d=yield getConfig(),e=d.profilePicturePath.slice(d.profilePicturePath.search("MonkeyWebData")+14)+ID;$.get(e+".jpg").done(function(){$("#profileImg").attr("src",e+".jpg")}).fail(function(){$.get(e+".png").done(function(){$("#profileImg").attr("src",e+".png")}).fail(function(){$.get(e+".jpeg").done(function(){$("#profileImg").attr("src",e+".jpeg")}).fail(function(){log("can't find picture")})})})});return function(){return c.apply(this,arguments)}})(),loadRecieptImg=(()=>{var c=_asyncToGenerator(function*(){let d=yield getConfig(),e=$("#quarterSelect option:selected").text(),f=d.receiptPath.slice(d.receiptPath.search("MonkeyWebData")+14)+e+"/"+ID;$.get(f+".jpg").done(function(){$("#recieptImg").attr("src",f+".jpg")}).fail(function(){$.get(f+".png").done(function(){$("#recieptImg").attr("src",f+".png")}).fail(function(){$.get(f+".jpeg").done(function(){$("#recieptImg").attr("src",f+".jpeg")}).fail(function(){log("can't find picture"),$("#recieptImg").attr("src","images/nopic.png")})})})});return function(){return c.apply(this,arguments)}})(),genQuarterSelect=(()=>{var c=_asyncToGenerator(function*(){let d=yield listQuarter("private");for(let f in d.quarter)$("#quarterSelect").append("<option value="+d.quarter[f].year+"-"+d.quarter[f].quarter+">"+d.quarter[f].name+"</option>");let e=getCookieDict();if(e.monkeyWebSelectedQuarter===void 0){let f=yield getConfig(),g=f.defaultQuarter.quarter.year+"-"+f.defaultQuarter.quarter.quarter;$("#quarterSelect").val(g),writeCookie("monkeyWebSelectedQuarter",g)}else $("#quarterSelect").val(e.monkeyWebSelectedQuarter);genStudentData(),loadRecieptImg(),showChatData()});return function(){return c.apply(this,arguments)}})(),genStudentData=(()=>{var c=_asyncToGenerator(function*(){let d=$("#quarterSelect").val();writeCookie("courseQuarter",d);let e=yield studentProfile(ID);$("#studentProfileContent").empty(),$("#studentProfileContent").append("<h4>"+e.firstname+" ("+e.nickname+") "+e.lastname+"</h4><h4>"+e.firstnameEn+" ("+e.nicknameEn+") "+e.lastnameEn+"</h4><h4><span class='fa fa-graduation-cap'></span> "+(6<e.grade?"S"+(e.grade-6):"P"+e.grade)+" <span class='fa fa-id-card-o'></span> "+ID+"</h4><h5>Level: "+e.level+"</h5><h5><span class='fa fa-envelope-o'></span> "+e.email+"</h5><h5><span class='fa fa-phone'></span> Student: "+e.phone+"</h5><h5><span class='fa fa-phone'></span> Parent: "+e.phoneParent+"</h5>"),10<parseInt(d.slice(5))?($("#smCoverDowload").show(),$("#mathCoverDowload").hide(),$("#phyCoverDowload").hide(),$("#cheCoverDowload").hide(),$("#engCoverDowload").hide()):($("#smCoverDowload").hide(),$("#mathCoverDowload").show(),$("#phyCoverDowload").show(),$("#cheCoverDowload").show(),$("#engCoverDowload").show()),genStatusPanel(e.status,e.quarter),genStudentTable(),genChangeInfoModal(e)});return function(){return c.apply(this,arguments)}})(),genStatusPanel=(()=>{var c=_asyncToGenerator(function*(d,e){let f=getCookieDict(),g=$("#statusButton"),j=$("#statusDropdown"),k=$("#statusSubButton");switch(g.removeClass("btn-danger btn-success btn-secondary btn-dark"),j.empty(),k.empty(),d){case"active":g.html("ACTIVE").addClass("btn-success"),k.append("<button class='col-12 btn btn-light subButt-unregistered' onclick=\"changeStudentState('unregistered')\">UNREGISTER</button><button class='col-12 btn btn-light subButt-untransferred' onclick=\"changeStudentState('untransferred')\">UNTRANSFER</button><button class='col-12 btn btn-light subButt-rejected' onclick=\"changeStudentState('rejected');\">REJECT</button><button class='col-12 btn btn-light subButt-transferred' onclick=\"changeStudentState('transferred')\">TRANSFER</button><button class='col-12 btn btn-light subButt-approved' onclick=\"changeStudentState('approved')\">APPROVE</button><button class='col-12 btn btn-light subButt-pending' onclick=\"changeStudentState('pending')\">PENDING</button><button class='col-12 btn btn-light subButt-finished' onclick=\"changeStudentState('finished');\">FINISH</button>");break;case"inactive":g.html("INACTIVE").addClass("btn-secondary"),k.append("<button class='col-12 btn btn-light'>Please login and fill profile data</button>");break;case"dropped":g.html("DROP").addClass("btn-danger"),k.append("<button class='col-12 btn btn-danger'>PENDING</button><button class='col-12 btn btn-light' onclick=\"changeStudentStatus('active')\">EDITED</button><button class='col-12 btn btn-light' onclick=\"changeStudentStatus('terminated')\">TERMINATE</button>");break;case"terminated":g.html("TERMINATE").addClass("btn-dark"),k.append("<button class='col-12 btn btn-light'>Please active again for regis</button>");break;default:}j.append("<a class='dropdown-item' onclick=\"changeStudentStatus('active')\">ACTIVE</a><a class='dropdown-item' onclick=\"changeStudentStatus('dropped')\">DROP</a>");let l=f.courseQuarter;if(void 0!=e){let m=!0;for(let n in e)e[n].year==l.slice(0,4)&&e[n].quarter==l.slice(5)&&(m=!1,$(".subButt-"+e[n].registrationState).removeClass("btn-light").addClass("btn-success"));m&&$(".subButt-unregistered").removeClass("btn-light").addClass("btn-success")}else{let m=yield studentProfile(ID);e=m.quarter,genStatusPanel(d,e)}});return function(){return c.apply(this,arguments)}})(),genStudentTable=(()=>{var c=_asyncToGenerator(function*(){let d=!1,e=!1,f=!1,g=!1,j=$("#quarterSelect").val();$(".selector").html("ADD SUBJ").removeClass("cr hb sk"),10<parseInt(j.slice(5))?($("#mainTable").collapse("hide"),$("#summerTable").collapse("show")):($("#mainTable").collapse("show"),$("#summerTable").collapse("hide"));let k=yield $.post("post/v1/studentTimeTable",{studentID:ID,year:j.slice(0,4),quarter:j.slice(5)});for(let l in k.course){let m=moment(k.course[l].day),n="Hybrid"==k.course[l].tutorName?"HB":k.course[l].tutorName;if($(".btn"+m.day()+m.hour()).html("CR:"+k.course[l].courseName+" - "+n).addClass("cr").attr("id",k.course[l].courseID),"Hybrid"==k.course[l].tutorName)switch(k.course[l].courseName.slice(0,1)){case"M":d=!0;break;case"P":e=!0;break;case"C":f=!0;break;case"E":g=!0;break;default:}}for(let l in k.hybrid){let m=moment(k.hybrid[l].day);switch($(".btn"+m.day()+m.hour()).html("FHB:"+k.hybrid[l].subject).addClass("hb").attr("id",k.hybrid[l].hybridID),k.hybrid[l].subject){case"M":d=!0;break;case"P":e=!0;break;case"C":f=!0;break;case"E":g=!0;break;default:}}for(let l in k.skill){let m=moment(k.skill[l].day);9==m.hour()&&m.hour(8),11==m.hour()&&m.hour(10),14==m.hour()&&m.hour(13),$(".btn"+m.day()+m.hour()).html("SKILL:"+k.skill[l].subject).addClass("sk").attr("id",k.skill[l].skillID)}genBarcode(),genTableTemplate(d,e,f,g)});return function(){return c.apply(this,arguments)}})(),genBarcode=(()=>{var c=_asyncToGenerator(function*(){JsBarcode("#mathBarcode",ID+"1",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#phyBarcode",ID+"2",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#cheBarcode",ID+"3",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#engBarcode",ID+"4",{lineColor:"black",width:3.4,height:68,displayValue:!1})});return function(){return c.apply(this,arguments)}})(),genTableTemplate=(()=>{var c=_asyncToGenerator(function*(d,e,f,g){let j=yield studentProfile(ID),k="images/TableCover/",l=6<j.grade?"h":"j";d&&(k+="m",$("#mathCoverDowload").removeClass("disabled")),e&&(k+="p",$("#phyCoverDowload").removeClass("disabled")),f&&(k+="c",$("#cheCoverDowload").removeClass("disabled")),g&&(k+="e",$("#engCoverDowload").removeClass("disabled")),k+=l+".png",$("#tableTemplate").attr("src",k)});return function(){return c.apply(this,arguments)}})(),genCover=(()=>{var c=_asyncToGenerator(function*(d){let e=$("#quarterSelect").val();if((4===d||5===d)&&10<parseInt(e.slice(5)))return void(4===d?genSmAppRej(1):genSmAppRej(2));let l,m,[f,g,j,k]=yield Promise.all([studentProfile(ID),$.post("post/v1/studentTimeTable",{studentID:ID,year:e.slice(0,4),quarter:e.slice(5)}),$.post("/v2/student/getRegistrationQuarter",{studentID:ID}),listQuarter("private")]);0===d?(l=document.getElementById("mathCover"),m=document.getElementById("mathBarcode")):1===d?(l=document.getElementById("phyCover"),m=document.getElementById("phyBarcode")):2===d?(l=document.getElementById("cheCover"),m=document.getElementById("cheBarcode")):3===d?(l=document.getElementById("engCover"),m=document.getElementById("engBarcode")):(l=document.getElementById("mathCover"),m=document.getElementById("mathBarcode"));let n=l.getContext("2d"),o=document.getElementById("tableTemplate");n.drawImage(o,0,0,1654,1170),n.textAlign="center",n.textBaseline="middle",n.font="bold 150px Cordia New",n.fillText(6<f.grade?"S"+(f.grade-6):"P"+f.grade,117,85);let p=document.getElementById("profileImg"),q=184,r=p.width*q/p.height;switch(n.drawImage(p,204,30,r,q),n.font="bold 80px Cordia New",d){case 0:n.fillText("ID: "+ID+"1",1025,63);break;case 1:n.fillText("ID: "+ID+"2",1025,63);break;case 2:n.fillText("ID: "+ID+"3",1025,63);break;case 3:n.fillText("ID: "+ID+"4",1025,63);break;default:n.fillText("ID: "+ID+"1",1025,63);}n.drawImage(m,900,115),n.fillText(f.firstname+" ("+f.nickname+")",600,80),n.fillText(f.lastname,600,170);let s=[1289,1508,811,1050],u=[315,437,559,681,875],v=[1335,1416,1498,1580],x=[140,220,300,380,460];for(let B in n.font="bold 60px Cordia New",n.fillStyle="#f442df",g.course)n.fillText("CR: "+g.course[B].courseName,s[dayIndex(g.course[B].day)],u[hourIndex(g.course[B].day)]),n.fillText("Hybrid"==g.course[B].tutorName?"HB":g.course[B].tutorName,s[dayIndex(g.course[B].day)],u[hourIndex(g.course[B].day)]+60),"Hybrid"==g.course[B].tutorName&&(0==d&&"M"==g.course[B].courseName.slice(0,1)?n.fillText("CR",v[dayIndex(g.course[B].day)],x[hourIndex(g.course[B].day)]):1==d&&"P"==g.course[B].courseName.slice(0,1)?n.fillText("CR",v[dayIndex(g.course[B].day)],x[hourIndex(g.course[B].day)]):2==d&&"C"==g.course[B].courseName.slice(0,1)?n.fillText("CR",v[dayIndex(g.course[B].day)],x[hourIndex(g.course[B].day)]):3==d&&"E"==g.course[B].courseName.slice(0,1)&&n.fillText("CR",v[dayIndex(g.course[B].day)],x[hourIndex(g.course[B].day)]));for(let B in g.hybrid)n.fillStyle="#242de2",n.fillText("FHB: "+g.hybrid[B].subject,s[dayIndex(g.hybrid[B].day)],u[hourIndex(g.hybrid[B].day)]),n.fillText("HB",s[dayIndex(g.hybrid[B].day)],u[hourIndex(g.hybrid[B].day)]+60),n.fillStyle="black",0==d&&"M"==g.hybrid[B].subject?n.fillText("HB",v[dayIndex(g.hybrid[B].day)],x[hourIndex(g.hybrid[B].day)]):1==d&&"P"==g.hybrid[B].subject?n.fillText("HB",v[dayIndex(g.hybrid[B].day)],x[hourIndex(g.hybrid[B].day)]):2==d&&"C"==g.hybrid[B].subject?n.fillText("HB",v[dayIndex(g.hybrid[B].day)],x[hourIndex(g.hybrid[B].day)]):3==d&&"E"==g.hybrid[B].subject&&n.fillText("HB",v[dayIndex(g.hybrid[B].day)],x[hourIndex(g.hybrid[B].day)]);for(let B in n.font="bold 50px Cordia New",n.fillStyle="orange",g.skill){let C=moment(g.skill[B].day);"ME"==g.skill[B].subject?(n.fillText("SK: M "+C.format("H:00"),s[dayIndex(g.skill[B].day)],u[hourIndex(g.skill[B].day)]),n.fillText("SK: E "+C.format("H:30"),s[dayIndex(g.skill[B].day)],u[hourIndex(g.skill[B].day)]+60)):9==C.hour()||11==C.hour()||14==C.hour()||16==C.hour()?n.fillText("SK: "+g.skill[B].subject+" "+C.format("H:mm"),s[dayIndex(g.skill[B].day)],u[hourIndex(g.skill[B].day)]+70):n.fillText("SK: "+g.skill[B].subject+" "+C.format("H:mm"),s[dayIndex(g.skill[B].day)],u[hourIndex(g.skill[B].day)])}n.fillStyle="black",n.textAlign="left";let y=_.union(j.registration.course,j.registration.hybrid),z="";for(let B in k.quarter)-1<y.indexOf(k.quarter[B].quarterID)&&(z+=k.quarter[B].name+" / ");if(n.fillText(z.slice(0,-3),35,1e3),n.fillStyle="black",n.textAlign="center",4==d||5==d){if(4==d)var A=document.getElementById("appRejCover1");else var A=document.getElementById("appRejCover2");let B=A.getContext("2d"),C=document.getElementById("recieptImg"),D=1654,E=C.height*D/C.width;B.drawImage(C,0,0,D,E);let F=document.getElementById("mathCover");B.globalAlpha=0.5,B.drawImage(F,0,0,1654,1170),B.globalAlpha=1,B.font="bold 400px Cordia New",B.rotate(Math.PI/6),4==d?(B.fillStyle="red",B.fillText("REJECT",350,200)):5==d&&(B.fillStyle="green",B.fillText("FINISHED",350,200)),downloadCanvas(d)}else downloadCanvas(d)});return function(){return c.apply(this,arguments)}})(),genSummerCover=(()=>{var c=_asyncToGenerator(function*(){let d=$("#quarterSelect").val(),e=moment(0);e.date(12).month(2).year(2018).hour(3);let f=moment(0);f.date(30).month(2).year(2018).hour(23);let[g,j,k]=yield Promise.all([listQuarter("private"),$.post("post/v1/studentTimeTable",{studentID:ID,year:d.slice(0,4),quarter:d.slice(5)}),$.post("post/v1/listAttendance",{studentStartDate:e.valueOf(),studentEndDate:f.valueOf(),studentID:ID})]);k.sort(function(v,x){return v.date-x.date});let l;for(let v in g.quarter)g.quarter[v].year===parseInt(d.slice(0,4))&&g.quarter[v].quarter===parseInt(d.slice(5))&&(l=g.quarter[v]);let m=document.getElementById("smCover"),n=m.getContext("2d"),o=document.getElementById("smTableTemplate");n.drawImage(o,0,0,1244,1760),n.textAlign="center",n.textBaseline="middle",n.font="bold 180px Cordia New",n.fillText(l.name,340,88),n.font="bold 80px Cordia New",n.fillText(ID,1100,65);let p=j.course,q={8:235,10:335,13:435};for(let v in n.textAlign="left",p){let x=moment(p[v].day);n.fillText(p[v].courseName+" - "+p[v].tutorName,370,q[x.hour()])}n.textAlign="center",n.font="bold 65px Cordia New";let r=moment(0),s=-1,u=696;for(let v in k){let x=696,y={8:380,10:470,13:560};if("SummerAbsent"===k[v].reason){let z=moment(k[v].date);r.date()===z.date()&&r.month()===z.month()&&r.year()===z.year()?n.fillText("\u2713",y[z.hour()],x+69*s):(s+=1,n.fillText(z.date(),120,x+69*s),n.fillText(z.month()+1,200,x+69*s),n.fillText((z.year()+"").slice(2),280,x+69*s),n.fillText("\u2713",y[z.hour()],x+69*s)),r=z}else if(2===k[v].type){let z=moment(k[v].date);15===z.hour()&&(n.fillText(z.date(),660,u),n.fillText(z.month()+1,750,u),n.fillText((z.year()+"").slice(2),840,u),u+=69)}}downloadCanvas(6)});return function(){return c.apply(this,arguments)}})(),genSmAppRej=(()=>{var c=_asyncToGenerator(function*(d){let e=$("#quarterSelect").val(),f=yield $.post("post/v1/studentTimeTable",{studentID:ID,year:e.slice(0,4),quarter:e.slice(5)}),g=document.getElementById("smAppRejCover"),j=document.getElementById("recieptImg");g.width=j.width,g.height=j.height;let k=j.height,l=j.width,m=g.getContext("2d");m.drawImage(j,0,0,l,k);let n=document.getElementById("smReceiptTemplate");m.globalAlpha=0.6;let o=n.height/n.width*l;m.drawImage(n,0,0,l,o),m.font="bold 60px Cordia New",m.textAlign="left",m.textBaseline="middle";let p={8:1*o/5,10:1.5*o/3,13:10*o/13},q=f.course;for(let s in q){let u=moment(q[s].day);m.fillText(q[s].courseName+" - "+q[s].tutorName,l/3,p[u.hour()])}m.globalAlpha=1,m.textAlign="center",m.font="bold 120px Cordia New",m.rotate(Math.PI/6);let r=Math.sqrt(Math.pow(l/2,2)+Math.pow(k/2,2));1===d?(m.fillStyle="red",m.fillText("REJECT",r,0)):2==d&&(m.fillStyle="green",m.fillText("FINISHED",r,0)),downloadCanvas(7)});return function(){return c.apply(this,arguments)}})(),showChatData=(()=>{var c=_asyncToGenerator(function*(){let e=yield $.post("post/v1/listChat",{studentID:ID,limit:3}),f=getCookieDict(),g=f.monkeyWebUser,j=e.chats;for(let k in $("#chatButt").empty(),j)j[k].sender._id===parseInt(g)?$("#chatButt").append("<row><p class='mb-0'><small><span class='fa fa-user-secret'></span>&nbsp;me</small></p><button class='btn btn-primary col-10'>"+j[k].msg+"</button></row>"):$("#chatButt").append("<row><p class='mb-0 float-right'><small>"+j[k].sender.nicknameEn+"&nbsp;<span class='fa fa-user'></span></small>&nbsp;</p><button class='btn btn-secondary col-10 offset-2'>"+j[k].msg+"</button></row>")});return function(){return c.apply(this,arguments)}})(),removeAllTimeTable=(()=>{var c=_asyncToGenerator(function*(){if(confirm("Are you sure to clear timetable?")){let d=[],e=[],f=[];if(0<$(".cr").length){for(let g=0;g<$(".cr").length;g++)d.push($(".cr")[g].id);yield removeStudentCourse(ID,d)}if(0<$(".hb").length){for(let g=0;g<$(".hb").length;g++)e.push(removeHybridStudent(ID,$(".hb")[g].id));yield Promise.all(e)}if(0<$(".sk").length){for(let g=0;g<$(".sk").length;g++)f.push(removeSkillStudent(ID,$(".sk")[g].id));yield Promise.all(f)}log("Finish to delete all data"),genStudentData()}});return function(){return c.apply(this,arguments)}})(),addTimeTable=(()=>{var c=_asyncToGenerator(function*(d){let e=$("#quarterSelect").val(),f=yield $.post("post/v1/listSubjectInQuarter",{year:e.slice(0,4),quarter:e.slice(5)});for(let g in $subjSelect=$("#subjSelect"),$subjSelect.empty(),f.hybrid){let j=moment(f.hybrid[g].day);0<=d.indexOf("btn"+j.day()+""+j.hour())&&($subjSelect.append("<option value="+f.hybrid[g].hybridID+">FHB:M</option>"),$subjSelect.append("<option value="+f.hybrid[g].hybridID+">FHB:P</option>"),$subjSelect.append("<option value="+f.hybrid[g].hybridID+">FHB:C</option>"),$subjSelect.append("<option value="+f.hybrid[g].hybridID+">FHB:E</option>"))}for(let g in f.course){let j=moment(f.course[g].day);0<=d.indexOf("btn"+j.day()+""+j.hour())&&$subjSelect.append("<option value="+f.course[g].courseID+">"+f.course[g].courseName+" - "+f.course[g].tutorName+"</option>")}for(let g in f.skill){let j=moment(f.skill[g].day),k=moment(f.skill[g].day);9==k.hour()&&k.hour(8),11==k.hour()&&k.hour(10),14==k.hour()&&k.hour(13),0<=d.indexOf("btn"+k.day()+""+k.hour())&&($subjSelect.append("<option value="+f.skill[g].skillID+">SKILL:M - "+j.format("HH:mm")+"</option>"),$subjSelect.append("<option value="+f.skill[g].skillID+">SKILL:E - "+j.format("HH:mm")+"</option>"),$subjSelect.append("<option value="+f.skill[g].skillID+">SKILL:ME - "+j.format("HH:mm")+"</option>"))}$("#addSubjModal").modal("show")});return function(){return c.apply(this,arguments)}})(),changeStudentInfo=(()=>{var c=_asyncToGenerator(function*(){let d={studentID:parseInt(ID)};""!=$("#nicknameInput").val()&&(d.nickname=$("#nicknameInput").val()),""!=$("#firstnameInput").val()&&(d.firstname=$("#firstnameInput").val()),""!=$("#lastnameInput").val()&&(d.lastname=$("#lastnameInput").val()),""!=$("#nicknameEInput").val()&&(d.nicknameEn=$("#nicknameEInput").val()),""!=$("#firstnameEInput").val()&&(d.firstnameEn=$("#firstnameEInput").val()),""!=$("#lastnameEInput").val()&&(d.lastnameEn=$("#lastnameEInput").val()),d.grade=parseInt($("#gradeInput").val()),""!=$("#levelInput").val()&&(d.level=$("#levelInput").val()),""!=$("#emailInput").val()&&(d.email=$("#emailInput").val()),""!=$("#phoneInput").val()&&(d.phone=$("#phoneInput").val()),""!=$("#parentPhoneInput").val()&&(d.phoneParent=$("#parentPhoneInput").val()),yield $.post("post/editStudent",d),log("Complete to change student info"),location.reload()});return function(){return c.apply(this,arguments)}})(),genCommentViewBody=(()=>{var c=_asyncToGenerator(function*(){$commentContentBody=$("#commentContentBody"),$commentContentBody.empty();let d=yield $.post("post/listStudentCommentByStudent",{studentID:ID});if(0==d.comment.length)$commentContentBody.append("<h5>No comment</h5>");else{let e=[];for(let g in d.comment)e.push(name(d.comment[g].tutorID));let f=yield Promise.all(e);for(let g in f)if($commentContentBody.append("<div id="+d.comment[g].commentID+"><h5><span class='fa fa-thumb-tack' style="+(0<d.comment[g].priority?"color:red":"color:silver")+" onclick=\"editComment('1','"+d.comment[g].commentID+"','"+d.comment[g].priority+"');\"></span> <span class='fa fa-check-circle' style="+(d.comment[g].isCleared?"color:green":"color:silver")+" onclick=\"editComment('2','"+d.comment[g].commentID+"','"+d.comment[g].isCleared+"');\"></span> "+f[g].nickname+" ("+moment(d.comment[g].timestamp).format("DD MMM")+") <span class='fa fa-trash' style='color:red' onclick=\"editComment('3','"+d.comment[g].commentID+"','');\"></span></h5><p>"+d.comment[g].message+"</p></div>"),d.comment[g].hasAttachment){let j=yield getConfig(),k=j.studentCommentPicturePath.slice(j.receiptPath.search("MonkeyWebData")+14)+"/"+d.comment[g].commentID;$.get(k+".jpg").done(function(){$("#"+d.comment[g].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+k+".jpg'>")}).fail(function(){$.get(k+".png").done(function(){$("#"+d.comment[g].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+k+".png'>")}).fail(function(){$.get(k+".jpeg").done(function(){$("#"+d.comment[g].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+k+".jpeg'>")}).fail(function(){log("can't find picture")})})})}}});return function(){return c.apply(this,arguments)}})(),showStudentAbsentHistory=(()=>{var c=_asyncToGenerator(function*(){let d=$("#quarterSelect").val(),e=$("#absentHistoryTableBody"),f=moment(),g=moment(0).year(f.year()).month(f.month()-3).date(f.date()),j=moment(0).year(f.year()).month(f.month()+3).date(f.date()),[k,l,m]=yield Promise.all([$.post("post/v1/listAttendance",{studentStartDate:g.valueOf(),studentEndDate:j.valueOf(),studentID:ID}),$.post("post/v1/listQuota",{studentID:ID}),$.post("post/v1/studentTimeTable",{year:d.slice(0,4),quarter:d.slice(5),studentID:ID})]),n=m.hybrid,o=0,p=0,q=0,r=0;for(let s in n)"M"===n[s].subject?p+=3:"P"===n[s].subject&&(o+=3);for(let s in log(k),k){1===k[s].type?void 0===k[s].courseName&&("M"===k[s].hybridSubject?r+=1:"P"===k[s].hybridSubject&&(q+=1)):"M"===k[s].subject?r-=1:"P"===k[s].subject&&(q-=1);let u=moment(k[s].date),v=moment(k[s].timestamp);e.append("<tr class='"+(1===k[s].type?"table-danger":"table-success")+"'><td class='text-center'>"+u.format("ddd DD/MM/YY HH:00")+"</td><td class='text-center'>"+(void 0===k[s].courseName?"FHB:"+(1===k[s].type?k[s].hybridSubject:k[s].subject):k[s].courseName)+"</td><td class='text-center'>"+(1===k[s].type?k[s].reason:"-")+"</td><td class='text-center'>"+v.format("ddd DD/MM/YY HH:mm")+"</td></tr>")}for(let s in l.quotaCount)"M"===l.quotaCount[s]._id?r-=l.quotaCount[s].value:"P"===l.quotaCount[s]._id&&(q-=l.quotaCount[s].value);$("#absentHistoryMQuota").html(p-r+"/"+p),$("#absentHistoryPQuota").html(o-q+"/"+o),$("#viewAbsentModal").modal("show")});return function(){return c.apply(this,arguments)}})();function _asyncToGenerator(c){return function(){var d=c.apply(this,arguments);return new Promise(function(e,f){function g(j,k){try{var l=d[j](k),m=l.value}catch(n){return void f(n)}return l.done?void e(m):Promise.resolve(m).then(function(n){g("next",n)},function(n){g("throw",n)})}return g("next")})}}767<$(document).width()&&($("#statusSidebar").addClass("position-fixed"),$("#profileImg").css("max-height","50vh"),$("#recieptImg").css("max-height","80vh"));let cookie=getCookieDict(),ID=cookie.monkeyWebAdminAllstudentSelectedUser;loadProfileImg(),genQuarterSelect(),$("#quarterSelect").change(function(){writeCookie("monkeyWebSelectedQuarter",this.value),loadRecieptImg(),genStudentData()}),$(".selector").click(function(){"ADD SUBJ"===$(this).html()?addTimeTable(this.className):$(this).hasClass("cr")?removeCourse(this.id):$(this).hasClass("hb")?removeHybrid(this.id):$(this).hasClass("sk")&&removeSkill(this.id)}),$("#addSubjButt").click(function(){addStudentTimeTable()});let uploadImgType=0;$("#profileImg").click(function(){uploadImgType=0,$("#uploadPicModal").modal("show")}),$("#recieptImg").click(function(){uploadImgType=1,$("#uploadPicModal").modal("show")}),$("#uploadPicButt").click(function(){confirm("\u0E22\u0E37\u0E19\u0E22\u0E31\u0E19\u0E01\u0E32\u0E23 upload?")&&uploadImg(uploadImgType)}),$("#studentProfileContent").click(function(){$("#changeStudentInfoModal").modal("show")}),$("#changeStudentInfoButt").click(function(){changeStudentInfo()}),$("#commentViewButt").click(function(){genCommentViewBody(),$("#viewCommentModal").modal("show")}),$("#addChatBtn").click(function(){$("#addChatModal").modal("show")}),$("#addNewChatButt").click(function(){addNewChat()}),$("#mathCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(0)}),$("#phyCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(1)}),$("#cheCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(2)}),$("#engCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(3)}),$("#smCoverDowload").click(function(){genSummerCover()});function genChangeInfoModal(c){$("#nicknameInput").attr("placeholder",c.nickname),$("#firstnameInput").attr("placeholder",c.firstname),$("#lastnameInput").attr("placeholder",c.lastname),$("#nicknameEInput").attr("placeholder",c.nicknameEn),$("#firstnameEInput").attr("placeholder",c.firstnameEn),$("#lastnameEInput").attr("placeholder",c.lastnameEn),$("#gradeInput").val(c.grade),$("#levelInput").attr("placeholder",c.level),$("#emailInput").attr("placeholder",c.email),$("#phoneInput").attr("placeholder",c.phone),$("#parentPhoneInput").attr("placeholder",c.phoneParent)}const dayIndex=c=>{switch(moment(c).day()){case 2:return 0;case 4:return 1;case 6:return 2;case 0:return 3;}},hourIndex=c=>{switch(moment(c).hour()){case 8:case 9:return 0;case 10:case 11:return 1;case 13:case 14:return 2;case 15:case 16:return 3;case 17:return 4;}};function downloadCanvas(c){let d="",e;switch(c){case 0:e=document.getElementById("mathCover"),d+=ID+"1.png";break;case 1:e=document.getElementById("phyCover"),d+=ID+"2.png";break;case 2:e=document.getElementById("cheCover"),d+=ID+"3.png";break;case 3:e=document.getElementById("engCover"),d+=ID+"4.png";break;case 4:e=document.getElementById("appRejCover1"),d+=ID+".png";break;case 5:e=document.getElementById("appRejCover2"),d+=ID+".png";break;case 6:e=document.getElementById("smCover"),d+=ID+"sm.png";break;case 7:e=document.getElementById("smAppRejCover"),d+=ID+".png";break;default:}let f=e.toDataURL(),g=document.createElement("a");g.href=f,g.download=d,document.body.appendChild(g),g.click()}function changeStudentStatus(c){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1B\u0E25\u0E35\u0E48\u0E22\u0E19 status?")&&$.post("post/changeStatus",{userID:ID,status:c}).then(()=>{log("OK:Change student status complete"),genStatusPanel(c)})}function changeStudentState(c){let d=$("#quarterSelect").val();confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1B\u0E25\u0E35\u0E48\u0E22\u0E19 state?")&&("rejected"==c?genCover(4):"finished"==c&&genCover(5),"UNREGISTER"==$($("#statusSubButton .btn-success")).html()?changeRegistrationState(ID,c,{year:d.slice(0,4),quarter:d.slice(5)}).then(()=>{log("OK:Change student state complete"),genStatusPanel("active")}):$.post("post/v1/updateStudentRegistrationState",{studentID:ID,year:d.slice(0,4),quarter:d.slice(5),registrationState:c,subRegistrationState:"-"}).then(()=>{log("OK:Change student state complete"),genStatusPanel("active")}))}function addNewChat(){let c={};0<$("#chatMsg").val().length?(c.msg=$("#chatMsg").val(),c.studentID=ID,$.post("post/v1/addChat",c).then(d=>{log(d),showChatData(),$("#chatMsg").val(""),$("#addChatModal").modal("hide")})):alert("Please input some text.")}function removeCourse(c){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E04\u0E2D\u0E23\u0E4C\u0E2A\u0E19\u0E35\u0E49?")&&removeStudentCourse(ID,[c]).then(()=>{log("finish to remove cr "+c),location.reload()})}function removeHybrid(c){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A FHB \u0E19\u0E35\u0E49?")&&removeHybridStudent(ID,c).then(()=>{log("finish to remove fhb "+c),location.reload()})}function removeSkill(c){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A skill \u0E19\u0E35\u0E49?")&&(log("rm sk"+c),removeSkillStudent(ID,c).then(()=>{log("finish to remove skill "+c),location.reload()}))}function addStudentTimeTable(){let c=$("#subjSelect").val(),d=$("#subjSelect option:selected").text();"FHB"===d.slice(0,3)?confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+d)&&addHybridStudent(c,ID,d.slice(4)).then(()=>{log("finish to add "+d),location.reload()}):"SKI"===d.slice(0,3)?confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+d)&&addSkillStudent(c,ID,d.slice(6,d.indexOf("-")-1)).then(()=>{log("finish to add "+d),location.reload()}):confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+d)&&addStudentCourse(ID,[c]).then(()=>{log("finish to add CR:"+d),location.reload()})}function uploadImg(c){let d=$("#quarterSelect").val(),e="",f=$("#file-img"),g=f.val().split(".").pop().toLowerCase();if(-1===$.inArray(g,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let j=f.get(0).files,k=new FormData,l=j[0];k.append("file[]",l,l.name),0==c?(e="post/updateProfilePicture",k.append("userID",ID)):1==c&&(e="post/submitReceipt",k.append("studentID",ID),k.append("year",d.slice(0,4)),k.append("quarter",d.slice(5))),$.ajax({url:e,type:"POST",data:k,processData:!1,contentType:!1,success:function(){location.reload()}})}}function editComment(c,d,e){switch(c){case"1":$.post("post/changeStudentCommentPriority",{commentID:d,priority:0<e?0:1});break;case"2":$.post("post/clearStudentComment",{commentID:d,isCleared:"true"!=e});break;case"3":confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A comment \u0E19\u0E35\u0E49?")&&$.post("post/removeStudentComment",{commentID:d});break;default:}genCommentViewBody()}$("#absentViewButt").click(function(){showStudentAbsentHistory()});