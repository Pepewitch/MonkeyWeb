let loadProfileImg=(()=>{var a=_asyncToGenerator(function*(){let b=yield getConfig(),c=b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+ID;$.get(c+".jpg").done(function(){$("#profileImg").attr("src",c+".jpg")}).fail(function(){$.get(c+".png").done(function(){$("#profileImg").attr("src",c+".png")}).fail(function(){$.get(c+".jpeg").done(function(){$("#profileImg").attr("src",c+".jpeg")}).fail(function(){log("can't find picture")})})})});return function(){return a.apply(this,arguments)}})(),loadRecieptImg=(()=>{var a=_asyncToGenerator(function*(){let b=yield getConfig(),c=$("#quarterSelect option:selected").text(),d=b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+c+"/"+ID;$.get(d+".jpg").done(function(){$("#recieptImg").attr("src",d+".jpg")}).fail(function(){$.get(d+".png").done(function(){$("#recieptImg").attr("src",d+".png")}).fail(function(){$.get(d+".jpeg").done(function(){$("#recieptImg").attr("src",d+".jpeg")}).fail(function(){log("can't find picture"),$("#recieptImg").attr("src","images/noImage.svg")})})})});return function(){return a.apply(this,arguments)}})(),genQuarterSelect=(()=>{var a=_asyncToGenerator(function*(){let b=yield listQuarter("private");for(let d in b.quarter)$("#quarterSelect").append("<option value="+b.quarter[d].year+"-"+b.quarter[d].quarter+">"+b.quarter[d].name+"</option>");let c=getCookieDict();if(c.courseQuarter===void 0){let d=yield getConfig(),e=d.defaultQuarter.quarter.year+"-"+d.defaultQuarter.quarter.quarter;$("#quarterSelect").val(e),writeCookie("courseQuarter",e)}else $("#quarterSelect").val(c.courseQuarter);genStudentData(),loadRecieptImg()});return function(){return a.apply(this,arguments)}})(),genStudentData=(()=>{var a=_asyncToGenerator(function*(){let b=$("#quarterSelect").val();writeCookie("courseQuarter",b);let c=yield studentProfile(ID);$("#studentProfileContent").empty(),$("#studentProfileContent").append("<h4>"+c.firstname+" ("+c.nickname+") "+c.lastname+"</h4><h4>"+c.firstnameEn+" ("+c.nicknameEn+") "+c.lastnameEn+"</h4><h4><span class='fa fa-graduation-cap'></span> "+(6<c.grade?"S"+(c.grade-6):"P"+c.grade)+" <span class='fa fa-id-card-o'></span> "+ID+"</h4><h5>Level: "+c.level+"</h5><h5><span class='fa fa-envelope-o'></span> "+c.email+"</h5><h5><span class='fa fa-phone'></span> Student: "+c.phone+"</h5><h5><span class='fa fa-phone'></span> Parent: "+c.phoneParent+"</h5>"),genStatusPanel(c.status,c.quarter),genStudentTable(),genChangeInfoModal(c)});return function(){return a.apply(this,arguments)}})(),genStatusPanel=(()=>{var a=_asyncToGenerator(function*(b,c){let d=getCookieDict(),e=$("#statusButton"),f=$("#statusDropdown"),g=$("#statusSubButton");switch(e.removeClass("btn-danger btn-success btn-secondary btn-dark"),f.empty(),g.empty(),b){case"active":e.html("ACTIVE").addClass("btn-success"),g.append("<button class='col-12 btn btn-light subButt-unregistered' onclick=\"changeStudentState('unregistered')\">UNREGISTER</button><button class='col-12 btn btn-light subButt-untransferred' onclick=\"changeStudentState('untransferred')\">UNTRANSFER</button><button class='col-12 btn btn-light subButt-rejected' onclick=\"changeStudentState('rejected')\">REJECT</button><button class='col-12 btn btn-light subButt-transferred' onclick=\"changeStudentState('transferred')\">TRANSFER</button><button class='col-12 btn btn-light subButt-approved' onclick=\"changeStudentState('approved')\">APPROVE</button><button class='col-12 btn btn-light subButt-pending' onclick=\"changeStudentState('pending')\">PENDING</button><button class='col-12 btn btn-light subButt-finished' onclick=\"changeStudentState('finished')\">FINISH</button>");break;case"inactive":e.html("INACTIVE").addClass("btn-secondary"),g.append("<button class='col-12 btn btn-light'>Please login and fill profile data</button>");break;case"dropped":e.html("DROP").addClass("btn-danger"),g.append("<button class='col-12 btn btn-danger'>PENDING</button><button class='col-12 btn btn-light' onclick=\"changeStudentStatus('active')\">EDITED</button><button class='col-12 btn btn-light' onclick=\"changeStudentStatus('terminated')\">TERMINATE</button>");break;case"terminated":e.html("TERMINATE").addClass("btn-dark"),g.append("<button class='col-12 btn btn-light'>Please active again for regis</button>");break;default:}f.append("<a class='dropdown-item' onclick=\"changeStudentStatus('active')\">ACTIVE</a><a class='dropdown-item' onclick=\"changeStudentStatus('dropped')\">DROP</a>");let j=d.courseQuarter;if(void 0!=c){let k=!0;for(let l in c)c[l].year==j.slice(0,4)&&c[l].quarter==j.slice(5)&&(k=!1,$(".subButt-"+c[l].registrationState).removeClass("btn-light").addClass("btn-success"));k&&$(".subButt-unregistered").removeClass("btn-light").addClass("btn-success")}else{let k=yield studentProfile(ID);c=k.quarter,genStatusPanel(b,c)}});return function(){return a.apply(this,arguments)}})(),genStudentTable=(()=>{var a=_asyncToGenerator(function*(){let b=!1,c=!1,d=$("#quarterSelect").val();$(".selector").html("ADD SUBJ").removeClass("cr hb sk"),4<parseInt(d.slice(5))?($("#mainTable").collapse("hide"),$("#summerTable").collapse("show")):($("#mainTable").collapse("show"),$("#summerTable").collapse("hide"));let e=yield $.post("post/v1/studentTimeTable",{studentID:ID,year:d.slice(0,4),quarter:d.slice(5)});for(let f in e.course){let g=moment(e.course[f].day),j="Hybrid"==e.course[f].tutorName?"HB":e.course[f].tutorName;$(".btn"+g.day()+g.hour()).html("CR:"+e.course[f].courseName+" - "+j).addClass("cr").attr("id",e.course[f].courseID),"Hybrid"==e.course[f].tutorName&&("P"==e.course[f].courseName.slice(0,1)?c=!0:b=!0)}for(let f in e.hybrid){let g=moment(e.hybrid[f].day);$(".btn"+g.day()+g.hour()).html("FHB:"+e.hybrid[f].subject).addClass("hb").attr("id",e.hybrid[f].hybridID),"P"==e.hybrid[f].subject?c=!0:b=!0}for(let f in e.skill){let g=moment(e.skill[f].day);9==g.hour()&&g.hour(8),11==g.hour()&&g.hour(10),14==g.hour()&&g.hour(13),$(".btn"+g.day()+g.hour()).html("SKILL:"+e.skill[f].subject).addClass("sk").attr("id",e.skill[f].skillID)}genBarcode(),genTableTemplate(b,c)});return function(){return a.apply(this,arguments)}})(),genBarcode=(()=>{var a=_asyncToGenerator(function*(){JsBarcode("#mathBarcode",ID+"1",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#phyBarcode",ID+"2",{lineColor:"black",width:3.4,height:68,displayValue:!1})});return function(){return a.apply(this,arguments)}})(),genTableTemplate=(()=>{var a=_asyncToGenerator(function*(b,c){let d=yield studentProfile(ID),e=6<d.grade?"h":"j";b&&c?$("#tableTemplate").attr("src","images/mp"+e+".png"):b?($("#tableTemplate").attr("src","images/m"+e+".png"),$("#phyCoverDownloadButt").addClass("disabled")):c&&($("#tableTemplate").attr("src","images/p"+e+".png"),$("#mathCoverDownloadButt").addClass("disabled"))});return function(){return a.apply(this,arguments)}})(),genCover=(()=>{var a=_asyncToGenerator(function*(b){let c=$("#quarterSelect").val(),[d,e]=yield Promise.all([studentProfile(ID),$.post("post/v1/studentTimeTable",{studentID:ID,year:c.slice(0,4),quarter:c.slice(5)})]);if(0==b)var f=document.getElementById("mathCover"),g=document.getElementById("mathBarcode");else var f=document.getElementById("phyCover"),g=document.getElementById("phyBarcode");let j=f.getContext("2d"),k=document.getElementById("tableTemplate");j.drawImage(k,0,0,1654,1170),j.textAlign="center",j.textBaseline="middle",j.font="bold 150px Cordia New",j.fillText(6<d.grade?"S"+(d.grade-6):"P"+d.grade,112,88);let l=document.getElementById("profileImg"),m=184,n=l.width*m/l.height;j.drawImage(l,205,30,n,m),j.font="bold 80px Cordia New",j.fillText("ID: "+ID,560,63),j.drawImage(g,435,115),j.fillText(d.firstname+" ("+d.nickname+")",930,80),j.fillText(d.lastname,930,170);let o=[327,566,811,1050],p=[380,510,637,767,900],q=[1335,1416,1498,1580],r=[140,215,290,365,440];for(let s in j.font="bold 60px Cordia New",e.course)j.fillText("CR: "+e.course[s].courseName,o[dayIndex(e.course[s].day)],p[hourIndex(e.course[s].day)]),j.fillText("Hybrid"==e.course[s].tutorName?"HB":e.course[s].tutorName,o[dayIndex(e.course[s].day)],p[hourIndex(e.course[s].day)]+60),"Hybrid"==e.course[s].tutorName&&(0==b&&"M"==e.course[s].courseName.slice(0,1)?j.fillText("CR",q[dayIndex(e.course[s].day)],r[hourIndex(e.course[s].day)]):1==b&&"P"==e.course[s].courseName.slice(0,1)&&j.fillText("CR",q[dayIndex(e.course[s].day)],r[hourIndex(e.course[s].day)]));for(let s in e.hybrid)j.fillText("FHB: "+e.hybrid[s].subject,o[dayIndex(e.hybrid[s].day)],p[hourIndex(e.hybrid[s].day)]),j.fillText("HB",o[dayIndex(e.hybrid[s].day)],p[hourIndex(e.hybrid[s].day)]+60),0==b&&"M"==e.hybrid[s].subject?j.fillText("HB",q[dayIndex(e.hybrid[s].day)],r[hourIndex(e.hybrid[s].day)]):1==b&&"P"==e.hybrid[s].subject&&j.fillText("HB",q[dayIndex(e.hybrid[s].day)],r[hourIndex(e.hybrid[s].day)]);for(let s in e.skill){let t=moment(e.skill[s].day);"ME"==e.skill[s].subject?(j.fillText("SK: M "+t.format("H:00"),o[dayIndex(e.skill[s].day)],p[hourIndex(e.skill[s].day)]),j.fillText("SK: E "+t.format("H:30"),o[dayIndex(e.skill[s].day)],p[hourIndex(e.skill[s].day)]+60)):9==t.hour()||11==t.hour()||14==t.hour()||16==t.hour()?j.fillText("SK: "+e.skill[s].subject+" "+t.format("H:mm"),o[dayIndex(e.skill[s].day)],p[hourIndex(e.skill[s].day)]+60):j.fillText("SK: "+e.skill[s].subject+" "+t.format("H:mm"),o[dayIndex(e.skill[s].day)],p[hourIndex(e.skill[s].day)])}downloadCanvas(b)});return function(){return a.apply(this,arguments)}})(),addTimeTable=(()=>{var a=_asyncToGenerator(function*(b){let c=$("#quarterSelect").val(),d=yield $.post("post/v1/listSubjectInQuarter",{year:c.slice(0,4),quarter:c.slice(5)});for(let e in $subjSelect=$("#subjSelect"),$subjSelect.empty(),d.hybrid){let f=moment(d.hybrid[e].day);0<=b.indexOf("btn"+f.day()+""+f.hour())&&($subjSelect.append("<option value="+d.hybrid[e].hybridID+">FHB:M</option>"),$subjSelect.append("<option value="+d.hybrid[e].hybridID+">FHB:P</option>"))}for(let e in d.course){let f=moment(d.course[e].day);0<=b.indexOf("btn"+f.day()+""+f.hour())&&$subjSelect.append("<option value="+d.course[e].courseID+">"+d.course[e].courseName+" - "+d.course[e].tutorName+"</option>")}for(let e in d.skill){let f=moment(d.skill[e].day),g=moment(d.skill[e].day);9==g.hour()&&g.hour(8),11==g.hour()&&g.hour(10),14==g.hour()&&g.hour(13),0<=b.indexOf("btn"+g.day()+""+g.hour())&&($subjSelect.append("<option value="+d.skill[e].skillID+">SKILL:M - "+f.format("HH:mm")+"</option>"),$subjSelect.append("<option value="+d.skill[e].skillID+">SKILL:E - "+f.format("HH:mm")+"</option>"),$subjSelect.append("<option value="+d.skill[e].skillID+">SKILL:ME - "+f.format("HH:mm")+"</option>"))}$("#addSubjModal").modal("show")});return function(){return a.apply(this,arguments)}})(),changeStudentInfo=(()=>{var a=_asyncToGenerator(function*(){let b={studentID:parseInt(ID)};""!=$("#nicknameInput").val()&&(b.nickname=$("#nicknameInput").val()),""!=$("#firstnameInput").val()&&(b.firstname=$("#firstnameInput").val()),""!=$("#lastnameInput").val()&&(b.lastname=$("#lastnameInput").val()),""!=$("#nicknameEInput").val()&&(b.nicknameEn=$("#nicknameEInput").val()),""!=$("#firstnameEInput").val()&&(b.firstnameEn=$("#firstnameEInput").val()),""!=$("#lastnameEInput").val()&&(b.lastnameEn=$("#lastnameEInput").val()),b.grade=parseInt($("#gradeInput").val()),""!=$("#levelInput").val()&&(b.level=$("#levelInput").val()),""!=$("#emailInput").val()&&(b.email=$("#emailInput").val()),""!=$("#phoneInput").val()&&(b.phone=$("#phoneInput").val()),""!=$("#parentPhoneInput").val()&&(b.phoneParent=$("#parentPhoneInput").val()),yield $.post("post/editStudent",b),log("Complete to change student info"),location.reload()});return function(){return a.apply(this,arguments)}})(),genCommentViewBody=(()=>{var a=_asyncToGenerator(function*(){$commentContentBody=$("#commentContentBody"),$commentContentBody.empty();let b=yield $.post("post/listStudentCommentByStudent",{studentID:ID});if(0==b.comment.length)$commentContentBody.append("<h5>No comment</h5>");else{let c=[];for(let e in b.comment)c.push(name(b.comment[e].tutorID));let d=yield Promise.all(c);for(let e in d)if($commentContentBody.append("<div id="+b.comment[e].commentID+"><h5><span class='fa fa-thumb-tack' style="+(0<b.comment[e].priority?"color:red":"color:silver")+" onclick=\"editComment('1','"+b.comment[e].commentID+"','"+b.comment[e].priority+"');\"></span> <span class='fa fa-check-circle' style="+(b.comment[e].isCleared?"color:green":"color:silver")+" onclick=\"editComment('2','"+b.comment[e].commentID+"','"+b.comment[e].isCleared+"');\"></span> "+d[e].nickname+" ("+moment(b.comment[e].timestamp).format("DD MMM")+") <span class='fa fa-trash' style='color:red' onclick=\"editComment('3','"+b.comment[e].commentID+"','');\"></span></h5><p>"+b.comment[e].message+"</p></div>"),b.comment[e].hasAttachment){let f=yield getConfig(),g=f.studentCommentPicturePath.slice(f.receiptPath.search("MonkeyWebData")+14)+"/"+b.comment[e].commentID;$.get(g+".jpg").done(function(){$("#"+b.comment[e].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+g+".jpg'>")}).fail(function(){$.get(g+".png").done(function(){$("#"+b.comment[e].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+g+".png'>")}).fail(function(){$.get(g+".jpeg").done(function(){$("#"+b.comment[e].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+g+".jpeg'>")}).fail(function(){log("can't find picture")})})})}}});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var j=b[f](g),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){e("next",l)},function(l){e("throw",l)})}return e("next")})}}767<$(document).width()&&$("#statusSidebar").addClass("position-fixed");let cookie=getCookieDict(),ID=cookie.monkeyWebAdminAllstudentSelectedUser;loadProfileImg(),genQuarterSelect(),$("#quarterSelect").change(function(){loadRecieptImg(),genStudentData()}),$(".selector").click(function(){"ADD SUBJ"===$(this).html()?addTimeTable(this.className):$(this).hasClass("cr")?removeCourse(this.id):$(this).hasClass("hb")?removeHybrid(this.id):$(this).hasClass("sk")&&removeSkill(this.id)}),$("#addSubjButt").click(function(){addStudentTimeTable()});let uploadImgType=0;$("#profileImg").click(function(){uploadImgType=0,$("#uploadPicModal").modal("show")}),$("#recieptImg").click(function(){uploadImgType=1,$("#uploadPicModal").modal("show")}),$("#uploadPicButt").click(function(){confirm("\u0E22\u0E37\u0E19\u0E22\u0E31\u0E19\u0E01\u0E32\u0E23 upload?")&&uploadImg(uploadImgType)}),$("#studentProfileContent").click(function(){$("#changeStudentInfoModal").modal("show")}),$("#changeStudentInfoButt").click(function(){changeStudentInfo()}),$("#commentViewButt").click(function(){genCommentViewBody(),$("#viewCommentModal").modal("show")}),$("#mathCoverDownloadButt").click(function(){$(this).hasClass("disabled")||genCover(0)}),$("#phyCoverDownloadButt").click(function(){$(this).hasClass("disabled")||genCover(1)});function genChangeInfoModal(a){$("#nicknameInput").attr("placeholder",a.nickname),$("#firstnameInput").attr("placeholder",a.firstname),$("#lastnameInput").attr("placeholder",a.lastname),$("#nicknameEInput").attr("placeholder",a.nicknameEn),$("#firstnameEInput").attr("placeholder",a.firstnameEn),$("#lastnameEInput").attr("placeholder",a.lastnameEn),$("#gradeInput").val(a.grade),$("#levelInput").attr("placeholder",a.level),$("#emailInput").attr("placeholder",a.email),$("#phoneInput").attr("placeholder",a.phone),$("#parentPhoneInput").attr("placeholder",a.phoneParent)}const dayIndex=a=>{switch(moment(a).day()){case 2:return 0;case 4:return 1;case 6:return 2;case 0:return 3;}},hourIndex=a=>{switch(moment(a).hour()){case 8:case 9:return 0;case 10:case 11:return 1;case 13:case 14:return 2;case 15:case 16:return 3;case 17:return 4;}};function downloadCanvas(a){let b="";if(0==a){var c=document.getElementById("mathCover");b+=ID+"1.png"}else{var c=document.getElementById("phyCover");b+=ID+"2.png"}let d=c.toDataURL(),e=document.createElement("a");e.href=d,e.download=b,document.body.appendChild(e),e.click()}function changeStudentStatus(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1B\u0E25\u0E35\u0E48\u0E22\u0E19 status?")&&$.post("post/changeStatus",{userID:ID,status:a}).then(()=>{log("OK:Change student status complete"),genStatusPanel(a)})}function changeStudentState(a){let b=getCookieDict(),c=b.courseQuarter;confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1B\u0E25\u0E35\u0E48\u0E22\u0E19 state?")&&changeRegistrationState(ID,a,{year:c.slice(0,4),quarter:c.slice(5)}).then(()=>{log("OK:Change student state complete"),genStatusPanel("active")})}function removeCourse(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E04\u0E2D\u0E23\u0E4C\u0E2A\u0E19\u0E35\u0E49?")&&removeStudentCourse(ID,[a]).then(()=>{log("finish to remove cr "+a),location.reload()})}function removeHybrid(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A FHB \u0E19\u0E35\u0E49?")&&removeHybridStudent(ID,a).then(()=>{log("finish to remove fhb "+a),location.reload()})}function removeSkill(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A skill \u0E19\u0E35\u0E49?")&&(log("rm sk"+a),removeSkillStudent(ID,a).then(()=>{log("finish to remove skill "+a),location.reload()}))}function addStudentTimeTable(){let a=$("#subjSelect").val(),b=$("#subjSelect option:selected").text();"FHB"===b.slice(0,3)?confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+b)&&addHybridStudent(a,ID,b.slice(4)).then(()=>{log("finish to add "+b),location.reload()}):"SKI"===b.slice(0,3)?confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+b)&&addSkillStudent(a,ID,b.slice(6,b.indexOf("-")-1)).then(()=>{log("finish to add "+b),location.reload()}):confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+b)&&addStudentCourse(ID,[a]).then(()=>{log("finish to add CR:"+b),location.reload()})}function uploadImg(a){let b=$("#quarterSelect").val(),c="",d=$("#file-img"),e=d.val().split(".").pop().toLowerCase();if(-1===$.inArray(e,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let f=d.get(0).files,g=new FormData,j=f[0];g.append("file[]",j,j.name),0==a?(c="post/updateProfilePicture",g.append("userID",ID)):1==a&&(c="post/submitReceipt",g.append("studentID",ID),g.append("year",b.slice(0,4)),g.append("quarter",b.slice(5))),$.ajax({url:c,type:"POST",data:g,processData:!1,contentType:!1,success:function(){location.reload()}})}}function editComment(a,b,c){switch(a){case"1":$.post("post/changeStudentCommentPriority",{commentID:b,priority:0<c?0:1});break;case"2":$.post("post/clearStudentComment",{commentID:b,isCleared:"true"!=c});break;case"3":confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A comment \u0E19\u0E35\u0E49?")&&$.post("post/removeStudentComment",{commentID:b});break;default:}genCommentViewBody()}