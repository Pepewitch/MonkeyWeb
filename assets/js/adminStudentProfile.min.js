var studentForSearch=[];const getDateName=a=>{return["SUN","MON","TUE","WED","THU","FRI","SAT"][a]},getLetterGrade=a=>{return 6>=a?"P"+a:"S"+(a-6)};function getStudentProfile(){putQuarter();let a=getCookieDict(),b=a.monkeyWebAdminAllstudentSelectedUser;document.getElementById("studentID").innerHTML="ID: "+b;a.monkeyWebSelectedQuarter;studentProfile(b).then(d=>{log("[getStudentProfile()] : post/studentProfile => "),log(d),document.getElementById("studentName").innerHTML=d.firstname+" ("+d.nickname+") "+d.lastname,document.getElementById("studentNameEng").innerHTML=d.firstnameEn+" ("+d.nicknameEn+") "+d.lastnameEn,document.getElementById("studentLevel").innerHTML="Grade: "+getLetterGrade(d.grade),document.getElementById("email").innerHTML="e-mail: "+d.email,document.getElementById("phone").innerHTML="phone: "+d.phone,document.getElementById("summerStudentName").innerHTML=d.firstname+" ("+d.nickname+") "+d.lastname+" ("+getLetterGrade(d.grade)+")";var e,f;for(let g=0;g<d.quarter.length;g++)log(d.quarter[g]),d.quarter[g].year===parseInt(a.courseQuarter.substring(0,a.courseQuarter.indexOf("-")))&&d.quarter[g].quarter===parseInt(a.courseQuarter.substring(a.courseQuarter.indexOf("-")+1))&&(f=d.quarter[g].registrationState),d.quarter[g].year===parseInt(a.summerQuarter.substring(0,a.summerQuarter.indexOf("-")))&&d.quarter[g].quarter===parseInt(a.summerQuarter.substring(a.summerQuarter.indexOf("-")+1))&&(e=d.quarter[g].registrationState);if(void 0!==f&&(document.getElementById("studentStateCr").innerHTML="STAGE CR: "+f),void 0!==e)switch(document.getElementById("studentStateSm").innerHTML="STAGE SM: "+e,log(e),e){case"approved":document.getElementById("approveSummerBtn").className+=" disabled";break;case"rejected":document.getElementById("rejectSummerBtn").className+=" disabled";break;case"pending":document.getElementById("approveSummerBtn").className+=" disabled",document.getElementById("rejectSummerBtn").className+=" disabled",document.getElementById("pendingSummerBtn").className+=" disabled";break;case"finished":document.getElementById("approveSummerBtn").className+=" disabled",document.getElementById("rejectSummerBtn").className+=" disabled",document.getElementById("finishedSummerBtn").className+=" disabled";break;default:}return document.getElementById("studentStatus").innerHTML="STATUS: "+d.status,document.getElementById("thNName").value=d.nickname,document.getElementById("thName").value=d.firstname,document.getElementById("thSName").value=d.lastname,document.getElementById("enNName").value=d.nicknameEn,document.getElementById("enName").value=d.firstnameEn,document.getElementById("enSName").value=d.lastnameEn,document.getElementById("classStudent").value=d.grade,document.getElementById("stageStudent").value=d.registrationState,document.getElementById("statusStudent").value=d.status,document.getElementById("emailStudent").value=d.email,document.getElementById("telStudent").value=d.phone,d}).then(d=>{for(let g=0;g<d.courseID.length;g++)courseInfo(d.courseID[g]).then(h=>{if(h.err)log("[getStudentProfile()] : post/courseInfo => "+h.err);else{log("[getCourseDescription()] : post/courseInfo => "),log(h);let k=new Date(h.day),l=moment(0).day(k.getDay()).hour(k.getHours()).minute(k.getMinutes()).valueOf();document.getElementById(l).innerHTML=h.courseName,document.getElementById(l).value=d.courseID[g],document.getElementById(l).className="btn btn-warning col-md-12",name(h.tutor[0]).then(m=>{document.getElementById(l).innerHTML+=" - "+m.nicknameEn})}});log("[getStudentProfile()] All registered course => "),log(d.courseID);let e=d.hybridDay;for(let g=0;g<e.length;g++)document.getElementById(e[g].day).innerHTML="M"===e[g].subject?"FHB : M":"FHB : PH",document.getElementById(e[g].day).className="btn btn-primary col-md-12";let f=d.skillDay;for(let g=0;g<f.length;g++){let h=new Date(f[g].day),k=new Date(f[g].day);30===h.getMinutes()&&h.setMinutes(0),(9===h.getHours()||11===h.getHours()||14===h.getHours()||16===h.getHours())&&h.setHours(h.getHours()-1),log(h.getTime()),document.getElementById(""+h.getTime()).innerHTML="SKILL "+k.getHours()+":"+(0===k.getMinutes()?"00":"30"),document.getElementById(""+h.getTime()).className="btn btn-info col-md-12"}generateImageData()})}function generateImageData(){let a=!1,b=!1,c=parseInt(document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length)),d={id:""+c},e={},f={},g={};studentProfile(c).then(h=>{d.firstname=h.firstname,d.lastname=h.lastname,d.nickname=h.nickname,d.grade=""+h.grade;for(let k=0;k<h.skillDay.length;k++){let l=new Date(h.skillDay[k].day),m=l.getHours();(9===m||11===m||14===m||16===m)&&--m,e[getDateName(l.getDay())+m]={},e[getDateName(l.getDay())+m].courseName="SKILL "+l.getHours()+":"+(0===l.getMinutes()?"00":"30"),e[getDateName(l.getDay())+m].tutor=" "}for(let l,k=0;k<h.hybridDay.length;k++)l=new Date(h.hybridDay[k].day),e[getDateName(l.getDay())+l.getHours()]={},e[getDateName(l.getDay())+l.getHours()].courseName="M"===h.hybridDay[k].subject?"FHB : M":"FHB : PH",e[getDateName(l.getDay())+l.getHours()].tutor="Hybrid","M"===h.hybridDay[k].subject?(f[getDateName(l.getDay())+l.getHours()]="HB",a=!0):(g[getDateName(l.getDay())+l.getHours()]="HB",b=!0);return d.mathMiniTable=f,d.physicsMiniTable=g,h.courseID}).then(h=>{let k=[];for(let l=0;l<h.length;l++)k.push(courseInfo(h[l]));Promise.all(k).then(l=>{let m=[],n=[];for(let p,o=0;o<l.length;o++){p=l[o],n.push(p);let q=new Date(p.day);e[getDateName(q.getDay())+q.getHours()]={},e[getDateName(q.getDay())+q.getHours()].courseName="CR : "+p.courseName,99000===p.tutor[0]&&("M"===p.courseName[0]?(f[getDateName(q.getDay())+q.getHours()]="CR",a=!0):"P"===p.courseName[0]&&(g[getDateName(q.getDay())+q.getHours()]="CR",b=!0)),m.push(name(p.tutor[0]))}Promise.all(m).then(o=>{log(o.length);for(let p=0;p<o.length;p++){let q=o[p],r=new Date(n[p].day);e[getDateName(r.getDay())+r.getHours()].tutor=q.nicknameEn}}).then(()=>{d.mainTable=e,d.inMath=a,d.inPhy=b,log("[generateImageData()] : Generated info => "),log(d),barcode(d),d.inPhy&&d.inMath?($("#phyImg").attr("src","images/mp"+(6<d.grade?"h":"j")+".png"),$("#phy").attr("class","btn btn-default"),$("#phy").prop("disabled",!1),generateCover(d,"phy"),$("#mathImg").attr("src","images/mp"+(6<d.grade?"h":"j")+".png"),$("#math").attr("class","btn btn-default"),$("#math").prop("disabled",!1),generateCover(d,"math")):d.inPhy?($("#phyImg").attr("src","images/p"+(6<d.grade?"h":"j")+".png"),$("#phy").attr("class","btn btn-default"),$("#phy").prop("disabled",!1),generateCover(d,"phy")):d.inMath&&($("#mathImg").attr("src","images/m"+(6<d.grade?"h":"j")+".png"),$("#math").attr("class","btn btn-default"),$("#math").prop("disabled",!1),generateCover(d,"math")),generateSummerCover()})})})}function setRegistrationState(a,b){let c=parseInt(document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length));var d;switch(b){case"quarter":var e=document.getElementById("courseQuarter"),f=parseInt(e.options[e.selectedIndex].value.substring(0,e.options[e.selectedIndex].value.indexOf("-"))),e=parseInt(e.options[e.selectedIndex].value.substring(e.options[e.selectedIndex].value.indexOf("-")+1));d={year:2017,quarter:3};break;case"summer":var e=document.getElementById("summerQuarter"),f=parseInt(e.options[e.selectedIndex].value.substring(0,e.options[e.selectedIndex].value.indexOf("-"))),e=parseInt(e.options[e.selectedIndex].value.substring(e.options[e.selectedIndex].value.indexOf("-")+1));d={year:f,quarter:e};break;default:}log(d),changeRegistrationState(c,a,d).then(g=>{g.err?log("[setRegistrationState()] : post/changeRegistrationState => "+g.err):"summer"===b?"summer"==b&&(("finished"===a||"pending"===a)&&acRjSummer(a),log("[setRegistrationState()] : post/changeRegistrationState => Success")):(("finished"===a||"pending"===a)&&acceptReject(a),log("[setRegistrationState()] : post/changeRegistrationState => Success")),location.reload()})}function showProfilePic(){let a=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length);$.post("post/getConfig").then(b=>{$.get(b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+a+".jpg",function(c,d){"success"===d&&$("#profilePic").attr("src",b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+a+".jpg")}),$.get(b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+a+".jpeg",function(c,d){"success"===d&&$("#profilePic").attr("src",b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+a+".jpeg")}),$.get(b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+a+".png",function(c,d){"success"===d&&$("#profilePic").attr("src",b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+a+".png")})})}function addRemoveCourse(a){let b=document.getElementById(a);"Add Course"===b.innerHTML?allCourse().then(c=>{if(log(c),c.err)log("[addRemoveCourse()] : post/allCourse => "+c.err);else{let d=new Date(parseInt(a)),e=moment(0).day(0===d.getDay()?7:d.getDay()).hour(d.getHours()).valueOf();c.course=c.course.filter(k=>k.day===parseInt(e)),log("[addRemoveCourse()] : data.filter() => "),log(c);let f=document.getElementById("courseSelector");f.value=a,f.innerHTML="";let g=new Date(parseInt(a));if(1===g.getDay()||(f.innerHTML+="<option id='"+g.getTime()+"'>FHB : M</option>",f.innerHTML+="<option id='"+g.getTime()+"'>FHB : PH</option>"),2!==g.getDay()&&4!==g.getDay()&&1!==g.getDay())for(let k=0;4>k;k++)f.innerHTML+="<option id='"+g.getTime()+"'>SKILL "+g.getHours()+(0==k%2?":00":":30")+"</option>",g.setMinutes(g.getMinutes()+30);let h=[];for(let k=0;k<c.course.length;k++){let l=c.course[k],m="";m=6<l.grade[0]?"S"+l.grade.map(n=>n-6).join(""):"P"+l.grade.join(""),h.push(name(l.tutor[0]))}Promise.all(h).then(k=>{for(let m,l=0;l<c.course.length;l++)m="",m=6<c.course[l].grade[0]?"S"+c.course[l].grade.map(n=>n-6).join(""):"P"+c.course[l].grade.join(""),f.innerHTML+="<option id='"+c.course[l].courseID+"'>"+c.course[l].subject+m+c.course[l].level+" - "+k[l].nicknameEn+"</option>";$("#addModal").modal()})}}):(document.getElementById("confirmDelete").value=b.value,document.getElementById("courseName").innerHTML=b.innerHTML,document.getElementById("removeModal").value=a,$("#removeModal").modal())}function addCourse(){let a=document.getElementById("courseSelector"),b=parseInt(document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length)),c=a.options[a.selectedIndex],d=c.value;if("SKILL"===d.slice(0,5))addSkillDay(b,c.id).then(e=>{e.err?log("[addCourse()] : post/addSkillDay => "+e.err):(log("[addCourse()] : post/addSkillDay => Success"),location.reload())});else if("FHB"===d.slice(0,3))addHybridDay(b,"M"===d[d.length-1]?"M":"PH",c.id).then(e=>{e.err?log("[addCourse()] : post/addHybridDay => "+e.err):(log("[addCourse()] : post/addHybridDay => Success"),location.reload())});else{let e=c.id;addStudentCourse(b,[e]).then(f=>{f.err?log("[addCourse()] : post/addStudentCourse => "+f.err):(log("[addCourse()] : post/addStudentCourse => Success"),location.reload())})}}function removeCourse(){let a=document.getElementById("confirmDelete"),b=parseInt(document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length)),c=a.value,d=document.getElementById("courseName").innerHTML,e=parseInt(document.getElementById("removeModal").value);if("SKILL"===d.slice(0,5)){let f=new Date(e);f.setMinutes(parseInt(d.slice(d.indexOf(":")+1))),f.setHours(parseInt(d.slice(d.indexOf(" ")+1,d.indexOf(":")))),removeSkillDay(b,f.getTime()).then(g=>{g.err?log("[addCourse()] : post/removeSkillDay => "+g.err):(log("[addCourse()] : post/removeSkillDay => Success"),location.reload())})}else"FHB"===d.slice(0,3)?removeHybridDay(b,e).then(f=>{f.err?log("[addCourse()] : post/removeHybridDay => "+f.err):(log("[addCourse()] : post/removeHybridDay => Success"),location.reload())}):removeStudentCourse(b,[c]).then(f=>{f.err?log("[RemoveCourse()] : post/removeStudentCourse => "+f.err):(log("[RemoveCourse()] : post/removeStudentCourse => Success"),location.reload())})}function editStudent(){let a=parseInt(document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length)),b=(k,l)=>$.post("post/changeStatus",{userID:k,status:l}),c=document.getElementById("classStudent"),d=parseInt(c.options[c.selectedIndex].value),e=document.getElementById("stageStudent"),f=e.options[e.selectedIndex].value,g=document.getElementById("statusStudent"),h=g.options[g.selectedIndex].value;$.post("post/editStudent",{studentID:a,firstname:document.getElementById("thName").value,lastname:document.getElementById("thSName").value,nickname:document.getElementById("thNName").value,firstnameEn:document.getElementById("enName").value,lastnameEn:document.getElementById("enSName").value,nicknameEn:document.getElementById("enNName").value,email:document.getElementById("emailStudent").value,phone:document.getElementById("telStudent").value,grade:d}).then(()=>{return changeRegistrationState(a,f)}).then(()=>{b(a,h).then(()=>{location.reload()})})}function putQuarter(){var a=document.getElementById("courseQuarter"),b=document.getElementById("summerQuarter");let c=getCookieDict();position(c.monkeyWebUser).then(d=>{var e="public";switch(d.position){case"tutor":case"admin":e="protected";break;case"dev":e="private";}listQuarter(e).then(f=>{a.innerHTML="",b.innerHTML="";for(let h,g=0;g<f.quarter.length;g++)h="<option value = '"+f.quarter[g].year+"-"+f.quarter[g].quarter+"'>"+f.quarter[g].name+"</option>",10>f.quarter[g].quarter?a.innerHTML+=h:b.innerHTML+=h;getConfig().then(g=>{if(c.monkeyWebSelectedQuarter===void 0)a.value=g.defaultQuarter.quarter.year+"-"+g.defaultQuarter.quarter.quarter,b.value=g.defaultQuarter.summer.year+"-"+g.defaultQuarter.summer.quarter,writeCookie("courseQuarter",g.defaultQuarter.quarter.year+"-"+g.defaultQuarter.quarter.quarter),writeCookie("summerQuarter",g.defaultQuarter.summer.year+"-"+g.defaultQuarter.summer.quarter);else{let h=c.monkeyWebSelectedQuarter;10>parseInt(h.substring(h.indexOf("-")+1))?(a.value=c.monkeyWebSelectedQuarter,b.value=g.defaultQuarter.summer.year+"-"+g.defaultQuarter.summer.quarter,writeCookie("courseQuarter",c.monkeyWebSelectedQuarter),writeCookie("summerQuarter",b.value)):(a.value=g.defaultQuarter.quarter.year+"-"+g.defaultQuarter.quarter.quarter,b.value=c.monkeyWebSelectedQuarter,writeCookie("courseQuarter",g.defaultQuarter.quarter.year+"-"+g.defaultQuarter.quarter.quarter),writeCookie("summerQuarter",c.monkeyWebSelectedQuarter))}})})})}function quarterChange(){log("Hello")}function showReceipt(){let a=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length);$.post("post/getConfig").then(b=>{$.get(b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60Q3/"+a+".jpg",function(c,d){"success"===d&&$("#imgTrans").attr("src",b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60Q3/"+a+".jpg")}),$.get(b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60Q3/"+a+".jpeg",function(c,d){"success"===d&&$("#imgTrans").attr("src",b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60Q3/"+a+".jpeg")}),$.get(b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60Q3/"+a+".png",function(c,d){"success"===d&&$("#imgTrans").attr("src",b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60Q3/"+a+".png")}),$.get(b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60OCT/"+a+".jpg",function(c,d){"success"===d&&$("#smTrans").attr("src",b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60OCT/"+a+".jpg")}),$.get(b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60OCT/"+a+".jpeg",function(c,d){"success"===d&&$("#smTrans").attr("src",b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60OCT/"+a+".jpeg")}),$.get(b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60OCT/"+a+".png",function(c,d){"success"===d&&$("#smTrans").attr("src",b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+"CR60OCT/"+a+".png")})})}function barcode(a){const b=a.id;JsBarcode("#mathBarcode",b+"1",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#phyBarcode",b+"2",{lineColor:"black",width:3.4,height:68,displayValue:!1})}function acceptReject(a){let b=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length),c=document.getElementById("appRej"),d=c.getContext("2d"),e=document.getElementById("mathCanvas"),f=document.getElementById("imgTrans");d.fillStyle="white",d.fillRect(0,0,c.width,c.height),"pending"===a?(d.save(),d.drawImage(e,0,-100),d.drawImage(f,90,70,220,165),d.rotate(11*Math.PI/6),d.font="bold 55px Cordia New",d.fillStyle="orange",d.textAlign="center",d.fillText("Pending \u0E01\u0E23\u0E38\u0E13\u0E32\u0E15\u0E34\u0E14\u0E15\u0E48\u0E2D\u0E04\u0E23\u0E39\u0E41\u0E21\u0E27",150,340),d.restore()):"registered"==a&&(d.save(),d.drawImage(e,0,-100),d.drawImage(f,90,70,220,165),d.rotate(11*Math.PI/6),d.font="bold 90px Cordia New",d.fillStyle="green",d.textAlign="center",d.fillText("Approved",150,340),d.restore());let g=c.toDataURL(),h=document.createElement("a");h.href=g,h.download=b+a+".png",document.body.appendChild(h),h.click()}function acRjSummer(a){let b=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length),c=document.getElementById("acRjSummerCanvas"),d=c.getContext("2d"),e=document.getElementById("summerReceiptTableImg"),f=document.getElementById("smTrans");d.fillStyle="white",d.fillRect(0,0,c.width,c.height),d.save(),d.drawImage(e,Math.abs(e.width/e.height*c.height-c.width)/2,0,e.width/e.height*c.height,c.height),d.drawImage(f,(c.width-230*(f.width/f.height))/2,220,230*(f.width/f.height),230),d.font="bold 24px Cordia New",d.fillStyle="black",d.fillText("Add Course"===$("#-255600000").html()?"":$("#-255600000").html(),200,75),d.fillText("Add Course"===$("#-248400000").html()?"":$("#-248400000").html(),200,125),d.fillText("Add Course"===$("#-237600000").html()?"":$("#-237600000").html(),200,175),d.font="bold 90px Cordia New",d.textAlign="center",d.fillStyle="finished"==a?"green":"red",d.rotate(11*Math.PI/6),d.fillText("finished"==a?"FINISHED":"PENDING",160,400),d.restore();let g=c.toDataURL(),h=document.createElement("a");h.href=g,h.download=b+a+"(CR60OCT).png",document.body.appendChild(h),h.click()}function upPic(){let a=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length),b=$("#file-1"),c=b.val().split(".").pop().toLowerCase();if(-1===$.inArray(c,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let d=b.get(0).files,e=new FormData;e.append("file",d[0],d[0].name),e.append("userID",a),$.ajax({url:"post/updateProfilePicture",type:"POST",data:e,processData:!1,contentType:!1,success:function(){showProfilePic(),$("#profileModal").modal("hide")}})}}function upReciept(a){let b=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length),c="quarter"===a?$("#file-2"):$("#file-3"),d=c.val().split(".").pop().toLowerCase();if(-1===$.inArray(d,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let e=c.get(0).files,f=new FormData;f.append("file",e[0],e[0].name),f.append("studentID",b),f.append("quarter",a),$.ajax({url:"post/submitReceipt",type:"POST",data:f,processData:!1,contentType:!1,success:function(){$("#rcModal").modal("hide"),location.reload()}})}}function generateCover(a,b){let e=document.getElementById(b+"Canvas"),f=e.getContext("2d"),g=document.getElementById(b+"Img");f.drawImage(g,0,0,1654,1170),f.font="100px Oxygen",f.fillText(["P1","P2","P3","P4","P5","P6","S1","S2","S3","S4","S5","S6","SAT"][a.grade-1],50,128);let h=document.getElementById(b+"Barcode");f.drawImage(h,418,115);let k=document.getElementById("profilePic"),l=184,m=k.width*l/k.height;f.drawImage(k,205,30,m,l),f.font="bold 40px Taviraj","math"===b?f.fillText("ID: "+a.id+"1",445,84):f.fillText("ID: "+a.id+"2",445,84);let n=18<(a.firstname+a.nickname).length?a.firstname:a.firstname+" ("+a.nickname+")",o=18<(a.firstname+a.nickname).length?"("+a.nickname+") "+a.lastname:a.lastname;f.font="bold 52px Trirong",f.textAlign="center",f.fillText(n,930,94),f.fillText(o,930,174),f.textBaseline="middle";const p=["TUE","THU","SAT","SUN"],q=["8","10","13","15","17"],r=[1342,1420,1498,1576],s=[144,218,292,366,440],t=[324,568,812,1056],u=[386,514,642,770,898],v=[448,576,704,832,960];for(let w=0;4>w;w++)for(let y=0;5>y;y++){f.font="bold 28px Taviraj","math"===b?a.mathMiniTable[p[w]+q[y]]!==void 0&&f.fillText(a.mathMiniTable[p[w]+q[y]],r[w],s[y]):a.physicsMiniTable[p[w]+q[y]]!==void 0&&f.fillText(a.physicsMiniTable[p[w]+q[y]],r[w],s[y]),f.font="bold 36px Taviraj";let z=p[w]+q[y];if(a.mainTable[z]!==void 0){let A=Object.values(a.mainTable[z])[0];A=A.replace("PH","Ph"),A=A.replace("CH","Ch"),A=A.replace("SCI","Sci"),f.fillText(A,t[w],u[y]),"Hybrid"===Object.values(a.mainTable[z])[1]?f.fillText("HB",t[w],v[y]):f.fillText(Object.values(a.mainTable[z])[1],t[w],v[y])}}}function generateSummerCover(){let b=document.getElementById("summerCanvas"),c=b.getContext("2d"),d=document.getElementById("summerImg");c.drawImage(d,0,0,622,880),c.fillStyle="black",c.font="bold 24px Cordia New";let e=$("#studentID").html().slice(4,9);c.fillText(e,525,45),c.fillText("Add Course"===$("#-255600000").html()?"":$("#-255600000").html(),200,125),c.fillText("Add Course"===$("#-248400000").html()?"":$("#-248400000").html(),200,175),c.fillText("Add Course"===$("#-237600000").html()?"":$("#-237600000").html(),200,225),$.post("post/listStudentAttendanceModifierByStudent",{studentID:e,start:moment("10-09-2017 8:00","MM-DD-YYYY HH:mm").valueOf()}).then(f=>{var g=0,h=moment("10-08-2017","MM-DD-YYYY"),k=0;for(let m,l=0;l<f.modifier.length;l++)if(m=moment(f.modifier[l].day),"\u0E25\u0E32"===f.modifier[l].reason){if(m.date()!==h.date()){let n=(10>m.date()?"0"+m.date():m.date())+"  "+(m.month()+1)+"   "+(m.year()-1957);switch(c.fillText(n,50,355+35*g),m.hour()){case 8:c.fillText("\u2714",185,355+35*g);break;case 10:c.fillText("\u2714",230,355+35*g);break;case 13:c.fillText("\u2714",275,355+35*g);break;default:}h=m,g+=1}else switch(m.hour()){case 8:c.fillText("\u2714",185,355+35*(g-1));break;case 10:c.fillText("\u2714",230,355+35*(g-1));break;case 13:c.fillText("\u2714",275,355+35*(g-1));break;default:}}else if("\u0E40\u0E1E\u0E34\u0E48\u0E21"===f.modifier[l].reason){let n=(10>m.date()?"0"+m.date():m.date())+"  "+(m.month()+1)+"   "+(m.year()-1957);c.fillText(n,325,355+35*k),k+=1}})}function showComment(){let a=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length);$comment=$("#comment"),$("#comment").empty(),$comment.append("<a id='showAll' onClick='showAllComment()'>Click here to see all comment</a>"),$.post("post/listStudentCommentByStudent",{studentID:a,limit:10}).then(b=>{getName(b,0)})}function showAllComment(){let a=document.getElementById("studentID").innerHTML.slice(4,document.getElementById("studentID").innerHTML.length);$comment=$("#comment"),$("#comment").empty(),$comment.append("<a id='showSome' onClick='showComment()'>Click here to hide comment</a>"),$.post("post/listStudentCommentByStudent",{studentID:a}).then(b=>{getName(b,0)})}function getName(a,b){$.post("post/name",{userID:a.comment[b].tutorID}).then(c=>{let d=moment(a.comment[b].timestamp,"x").format("DD MMM"),e="<h4><span class='glyphicon glyphicon-pushpin'"+(0<a.comment[b].priority?"style='color:red'":"style='color:silver'")+"onClick='pin(\""+a.comment[b].commentID+"\","+(0<a.comment[b].priority?0:1)+");'></span><span class='glyphicon glyphicon-ok'"+(a.comment[b].isCleared?"style='color:green'":"style='color:silver'")+"onClick='clearComm(\""+a.comment[b].commentID+"\","+(a.comment[b].isCleared?0:1)+");'></span>"+c.nickname+" ("+d+") <span class='glyphicon glyphicon-trash' style='color:red' onClick='rmComm(\""+a.comment[b].commentID+"\");'></span></h4>";$("#comment").append(e),$("#comment").append("<p> "+a.comment[b].message+"</p>"),a.comment[b].hasAttachment?$.post("post/getConfig").then(f=>{let g=f.studentCommentPicturePath;g=g.slice(g.search("MonkeyWebData")+14)+a.comment[b].commentID,$.get(g+".jpg").done(function(){$("#comment").append("<div class='row'><img class='col-sm-4 col-xs-10' src='"+g+".jpg' class='img-thumbnail'></div>"),b<a.comment.length-1&&getName(a,b+1)}).fail(function(){$.get(g+".jpeg").done(function(){$("#comment").append("<div class='row'><img class='col-sm-4 col-xs-10' src='"+g+".jpeg' class='img-thumbnail'></div>"),b<a.comment.length-1&&getName(a,b+1)}).fail(function(){$.get(g+".png").done(function(){$("#comment").append("<div class='row'><img class='col-sm-4 col-xs-10' src='"+g+".png' class='img-thumbnail'></div>"),b<a.comment.length-1&&getName(a,b+1)}).fail(function(){b<a.comment.length-1&&getName(a,b+1)})})})}):b<a.comment.length-1&&getName(a,b+1)})}function clearComm(a,b){$.post("post/clearStudentComment",{commentID:a,isCleared:b}).then(()=>{showComment()})}function pin(a,b){$.post("post/changeStudentCommentPriority",{commentID:a,priority:b}).then(()=>{showComment()})}function rmComm(a){!0===confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A comment \u0E19\u0E35\u0E49")&&$.post("post/removeStudentComment",{commentID:a}).then(()=>{showComment()})}