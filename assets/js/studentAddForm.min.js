var nickname="",firstname="";$(document).ready(function(){let a=getCookieDict(),b=a.monkeyWebUser,c=2017,d=4,e=[],f=[];$("#datePicker").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[1,3,5],minDate:moment()}),$.post("post/getConfig").done(g=>{c=g.defaultQuarter.quarter.year,d=g.defaultQuarter.quarter.quarter,$.post("post/studentProfile",{studentID:b}).done(h=>{nickname=h.nickname,firstname=h.firstname,$.post("post/gradeCourse",{grade:h.grade,year:c,quarter:d}).done(k=>{for(let l=0;l<h.courseID.length;l++)for(let m=0;m<k.course.length;m++)h.courseID[l]===k.course[m].courseID&&e.push(k.course[m]);$.post("post/v1/listStudentHybrid",{studentID:b,year:c,quarter:d}).done(l=>{for(let m=0;m<l.length;m++)f.push(l[m]);fillTable(b,f),fillButt(e)})})})}),$("#datePicker").on("dp.change",function(){fillButt(e)}),$(".btn-default").click(function(){$(this).hasClass("disabled")||($(".btn-success").toggleClass("btn-default btn-success"),$(this).toggleClass("btn-default btn-success"))}),$("#submit").click(function(){if(0==$(".btn-success").length)alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E40\u0E27\u0E25\u0E32");else if(!$("#senderInput").val())alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E0A\u0E37\u0E48\u0E2D\u0E1C\u0E39\u0E49\u0E2A\u0E48\u0E07");else{let g=$("#datePicker").data("DateTimePicker").date(),h=[];if(2===g.day()||4===g.day())h.push(g.hour(17).minute(0).second(0).millisecond(0).valueOf());else for(let k=0;k<$(".btn-success").length;k++)h.push(parseInt(g.hour($($(".btn-success")[k]).attr("id").slice(3)).minute(0).second(0).millisecond(0).valueOf()));if(!0==confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+$("#subjInput").val()+" \u0E40\u0E27\u0E25\u0E32 "+moment(h[0]).format("HH:mm")+" \u0E27\u0E31\u0E19\u0E17\u0E35\u0E48 "+moment(h[0]).format("DD/MM/YYYY"))){let k="\n"+nickname+" "+firstname+"\n\u0E40\u0E1E\u0E34\u0E48\u0E21 "+$("#subjInput").val().slice(0,5)+"\n"+moment(h).format("ddd DD/MM/YYYY \u0E23\u0E2D\u0E1A HH:mm");Promise.all([$.post("post/addStudentAbsenceModifier",{studentID:b,day:h,reason:"add"+$("#subjInput").val().slice(0,5),sender:$("#senderInput").val()},()=>{}),$.post("post/lineNotify",{recipient:"MonkeyAdmin",message:k},()=>{})]).then(()=>{location.reload()})}}})});function fillButt(a){$(".selector").html("&nbsp;").removeClass("disabled course btn-success").addClass("btn-default");let b=$("#datePicker").data("DateTimePicker").date();if(2===b.day()||4===b.day())$("#btn8").html("17-19"),$("#btn10").addClass("disabled"),$("#btn13").addClass("disabled"),$("#btn15").addClass("disabled");else for(let d,c=0;c<a.length;c++)d=moment(a[c].day),d.day()==b.day()?$.post("post/name",{userID:a[c].tutor[0]},function(e){$("#btn"+d.hour()).html(a[c].courseName+" - "+e.nicknameEn).addClass("disabled course")}):$("#btn"+d.hour()).html(d.hour()+" - "+(d.hour()+2))}function fillTable(a,b){let c=moment();$.post("post/listStudentAttendanceModifierByStudent",{studentID:a,start:c.valueOf()}).done(d=>{for(let e=0;e<d.modifier.length;e++)if("addFHB:M"==d.modifier[e].reason)$("#presentTableBody").append("<tr><td class='text-center'>"+moment(d.modifier[e].day).format("ddd DD MMM HH:mm")+" MATH</td></tr>");else if("addFHB:P"==d.modifier[e].reason)$("#presentTableBody").append("<tr><td class='text-center'>"+moment(d.modifier[e].day).format("ddd DD MMM HH:mm")+" PHYSIC</td></tr>");else if("\u0E25\u0E32"!=d.modifier[e].reason&&"\u0E40\u0E1E\u0E34\u0E48\u0E21"!=d.modifier[e].reason&&""==d.modifier[e].subject)for(let f=0;f<b.length;f++)if(moment(b[f].day).hour()==moment(d.modifier[e].day).hour()&&moment(b[f].day).day()==moment(d.modifier[e].day).day()){let g="M"==b[f].subject?"FHB:M":"FHB:P";$("#absentTableBody").append("<tr><td class='text-center'>"+moment(d.modifier[e].day).format("ddd DD MMM HH:mm")+" "+g+"</td></tr>")}})}