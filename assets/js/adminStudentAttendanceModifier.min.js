let genFhbTable=(()=>{var a=_asyncToGenerator(function*(){$("#fhbAbsentTable").empty(),$("#fhbPresentTable").empty();let b=$("#fhbDatePicker").data("DateTimePicker").date();b.hour(0);let c=yield $.post("post/v1/listAttendance",{date:b.valueOf()}),d=[],e=[];for(let h in c)e.push(name(c[h].userID)),0===c[h].courseID?d.push($.post("post/v1/studentHybridSubject",{studentID:c[h].userID,hybridID:c[h].hybridID})):d.push(courseInfo(c[h].courseID));let f=yield Promise.all(d),g=yield Promise.all(e);for(let h=0;h<c.length;h++){let j=moment(c[h].timestamp).format("ddd DD/MM/YY"),k=moment(c[h].date).hour(),l="";if(emergencyAbsent()&&(l="table-warning"),1===c[h].type){let m,n,o;if(0===c[h].courseID)m="FHB:"+f[h].subject,n="HB",o="FHB";else if(m="CR:"+f[h].courseName,99000===f[h].tutor[0])n="HB",o="HB";else{let p=yield name(f[h].tutor[0]);n=p.nicknameEn,o="CR"}$("#fhbAbsentTable").append("<tr id='"+c[h].attendanceID+"' class='fhbTableRow row"+k+" "+o+" "+l+"'><td class='text-center'>"+j+"</td><td class='text-center' onclick='gotoStdProfile(\""+c[h].userID+"\")'>"+g[h].nickname+" "+g[h].firstname+"</td><td class='text-center'>"+m+"</td><td class='text-center'>"+n+"</td><td class='text-center'>"+c[h].reason+"</td><td class='text-center'><button class='btn btn-light col' onclick='removeAdtend(\""+c[h].attendanceID+"\")'><span class='fa fa-lg fa-trash' style='color:red'></span></button></td></tr>")}else $("#fhbPresentTable").append("<tr id='"+c[h].attendanceID+"' class='fhbTableRow row"+k+"'><td class='text-center'>"+j+"</td><td class='text-center' onclick='gotoStdProfile(\""+c[h].userID+"\")'>"+g[h].nickname+" "+g[h].firstname+"</td><td class='text-center'>FHB:"+c[h].subject+"</td><td class='text-center'><button class='btn btn-light col' onclick='removeAdtend(\""+c[h].attendanceID+"\")'><span class='fa fa-lg fa-trash' style='color:red'></span></button></td></tr>")}filterFhbTable()});return function(){return a.apply(this,arguments)}})(),genActivityTable=(()=>{var a=_asyncToGenerator(function*(){let b=moment().valueOf(),c=yield $.post("post/v1/listAttendance",{startDate:0,endDate:b}),d=[],e=[];for(let h in c)e.push(name(c[h].userID)),0===c[h].courseID?d.push($.post("post/v1/studentHybridSubject",{studentID:c[h].userID,hybridID:c[h].hybridID})):d.push(courseInfo(c[h].courseID));let f=yield Promise.all(d),g=yield Promise.all(e);for(let h=0;h<c.length;h++){let j,k=moment(c[h].timestamp).format("ddd DD/MM/YY - HH:mm"),l,m=moment(c[h].date).format("ddd DD/MM/YY - HH:mm"),n;1===c[h].type?(j="table-danger",l=0===c[h].courseID?"FHB:"+f[h].subject:"CR:"+f[h].courseName,n=c[h].reason):(j="table-success",l="FHB:"+c[h].subject,n="-"),$("#acTableBody").append("<tr class='"+j+"' id='"+c[h].attendanceID+"'><td class='text-center'>"+k+"</td><td class='text-center' onclick='gotoStdProfile(\""+c[h].userID+"\")'>"+g[h].nickname+" "+g[h].firstname+"</td><td class='text-center'>"+l+"</td><td class='text-center'>"+m+"</td><td class='text-center'>"+n+"</td><td class='text-center'>"+c[h].sender+"</td><td class='text-center'><button class='btn btn-light col' onclick='removeAdtend(\""+c[h].attendanceID+"\")'><span class='fa fa-lg fa-trash' style='color:red'></span></button></td></tr>")}});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),j=h.value}catch(k){return void d(k)}return h.done?void c(j):Promise.resolve(j).then(function(k){e("next",k)},function(k){e("throw",k)})}return e("next")})}}$("#fhbDatePicker").datetimepicker({format:"DD/MM/YYYY",daysOfWeekDisabled:[1,3,5]}),genTimePicker(),genFhbTable(),$("#fhbDatePicker").on("dp.change",function(){genTimePicker(),genFhbTable()});function genTimePicker(){$("#fhbTimePick").empty();let a=$("#fhbDatePicker").data("DateTimePicker").date();2===a.day()||4===a.day()?$("#fhbTimePick").append("<option value=17>17-19</option>"):$("#fhbTimePick").append("<option value=8>8-10</option><option value=10>10-12</option><option value=13>13-15</option><option value=15>15-17</option>")}function emergencyAbsent(a,b){let c=!1,d=86400000,e=moment(b);return 0===e.day()?b-a<2*d&&(c=!0):b-a<d&&(c=!0),c}function filterFhbTable(){let a=$("#fhbTimePick").val(),b=$("#fhbFilterPick").val();switch($(".fhbTableRow").hide(),$(".row"+a).show(),b){case"FHB":$(".HB").hide(),$(".CR").hide();break;case"HB":$(".CR").hide();break;case"CR":$(".FHB").hide(),$(".HB").hide();break;default:}}$("#fhbTimePick").change(function(){filterFhbTable()}),$("#fhbFilterPick").change(function(){filterFhbTable()});function removeAdtend(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E1B\u0E23\u0E30\u0E27\u0E31\u0E15\u0E34\u0E19\u0E35\u0E49?")&&$.post("post/v1/deleteAttendance",{attendanceID:a}).then(b=>{log(b),$("#"+a).remove()})}function gotoStdProfile(a){writeCookie("monkeyWebAdminAllstudentSelectedUser",a),self.location="/adminStudentprofile"}genActivityTable();