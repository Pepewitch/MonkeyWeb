$(document).ready(function(){$('#datetimepicker1').datetimepicker({format:'DD/MM/YYYY H:00',daysOfWeekDisabled:[1,3,5]}),$('#datetimepicker1').on('dp.change',function(){genTable()}),genTable()});function genTable(){let a=$('.datePicker').data('DateTimePicker').date();$.post('post/listStudentAttendanceModifierByDay',{day:a.valueOf()}).then(b=>{$('#absentTable').empty(),$('#presentTable').empty(),0<b.absence.length&&($('#absentTable').append('<h3><kbd>\u0E25\u0E32</kbd></h3>'),$('#absentTable').append('<table class=\'table table-hover\'><thead><tr><th class=\'col-sm-1\'>Id</th><th class=\'col-sm-3\'>Name</th><th class=\'col-sm-1\'>Subject</th><th class=\'col-sm-4\'>Reason</th><th class=\'col-sm-1\'>Sender</th><th class=\'col-sm-2\'>Date</th></tr></thead><tbody id=\'absent\'></tbody></table>'),genAbsentTable(b,0)),0<b.presence.length&&($('#presentTable').append('<h3><kbd>\u0E40\u0E1E\u0E34\u0E48\u0E21</kbd></h3>'),$('#presentTable').append('<table class=\'table table-hover\'><thead><tr><th class=\'col-sm-1\'>Id</th><th class=\'col-sm-3\'>Name</th><th class=\'col-sm-5\'>Subject</th><th class=\'col-sm-1\'>Sender</th><th class=\'col-sm-2\'>Date</th></tr></thead><tbody id=\'present\'></tbody></table>'),genPresentTable(b,0)),0>=b.presence.length&&0>=b.absence.length&&$('#absentTable').append('<h1>No activity today</h1>')})}function genAbsentTable(a,b){if(b<a.absence.length){let c=a.absence[b].studentID,d=moment(a.absence[b].timestamp);chkEmergency(d)?$('#absent').append('<tr class=\'danger\'></tr>'):$('#absent').append('<tr></tr>'),$('#absent tr:last-child').append('<td>'+c+'</td>'),$.post('post/name',{userID:c}).then(f=>{let g=f.nickname+' '+f.firstname+' '+f.lastname;$('#absent tr:last-child').append('<td>'+g+'</td>'),'FHB'===a.absence[b].subject.slice(0,3)?($('#absent tr:last-child').append('<td>'+a.absence[b].subject+'</td>'),$('#absent tr:last-child').append('<td>'+a.absence[b].reason+'</td>'),$('#absent tr:last-child').append('<td>'+a.absence[b].sender+'</td>'),$('#absent tr:last-child').append('<td>'+d.format('DD/MM/YY H:mm')+'</td>'),genAbsentTable(a,b+1)):$.post('post/courseInfo',{courseID:a.absence[b].subject}).then(h=>{$('#absent tr:last-child').append('<td>'+h.courseName+'</td>'),$('#absent tr:last-child').append('<td>'+a.absence[b].reason+'</td>'),$('#absent tr:last-child').append('<td>'+a.absence[b].sender+'</td>'),$('#absent tr:last-child').append('<td>'+d.format('DD/MM/YY H:mm')+'</td>'),genAbsentTable(a,b+1)})})}}function genPresentTable(a,b){if(b<a.presence.length){let c=a.presence[b].studentID,d=moment(a.presence[b].timestamp),f=a.presence[b].subjectToAdd.slice(0,3)+': '+a.presence[b].subjectToAdd.slice(3,4);$('#present').append('<tr></tr>'),$('#present tr:last-child').append('<td>'+c+'</td>'),$.post('post/name',{userID:c}).then(g=>{let h=g.nickname+' '+g.firstname+' '+g.lastname;$('#present tr:last-child').append('<td>'+h+'</td>'),$('#present tr:last-child').append('<td>'+f+'</td>'),$('#present tr:last-child').append('<td>'+a.presence[b].sender+'</td>'),$('#present tr:last-child').append('<td>'+d.format('DD/MM/YY H:mm')+'</td>'),genPresentTable(a,b+1)})}}function chkEmergency(a){let b=$('.datePicker').data('DateTimePicker').date();if(2===b.day()||4===b.day()){if(a.year()<=b.year()&&a.month()<=b.month()&&a.date()<b.date())return!1;}else if(6===b.day()){if(a.year()<=b.year()&&a.month()<=b.month()&&a.date()<b.date())return!1;}else if(0===b.day()&&a.year()<=b.year()&&a.month()<=b.month()&&a.date()<b.date()-1)return!1;return!0}