const summerQ=12,summerMonth=9,summerYear=2017;$(document).ready(function(){genTableByName(),$("#smByName").collapse("show"),$("#aByName").click(function(){$("#smByWeek").collapse("hide"),setTimeout(function(){$("#smByName").collapse("show")},500)}),$("#aByWeek").click(function(){$("#smByName").collapse("hide"),setTimeout(function(){$("#smByWeek").collapse("show")},500)}),$("#weekSelect").change(function(){genTableByWeek()}),$("#typeSelect").change(function(){genTableByWeek()})});function genTableByName(){let a=[];$("#smByName").empty(),$("#smByName").append("<div class='row' id='smHeader'></div>"),$("#smHeader").append("<form class='col-sm-2'><div class='form-group'><label>Input Name:</label><input class='form-control typeahead' type='text' data-provide='typeahead' autofocus></div></form>"),$.post("post/allStudent").done(function(b){for(let c=0;c<b.student.length;c++)if("active"===b.student[c].status)for(let d=0;d<b.student[c].quarter.length;d++)b.student[c].quarter[d].quarter===summerQ&&a.push({name:b.student[c].nickname+" "+b.student[c].firstname,id:b.student[c].studentID});$(".typeahead").typeahead({source:a,autoSelect:!0}),$("#smByName").append("<div class='row'><div class='table-responsive col-sm-9'><table class='table table-hover table-bordered'><thead><tr><th colspan='4' class='danger text-center' style='font-size:2em'>\u0E25\u0E32</th></tr><tr><th class='text-center col-sm-6'>DATE</th><th class='text-center col-sm-2'>8.00-10.00</th><th class='text-center col-sm-2'>10.00-12.00</th><th class='text-center col-sm-2'>13.00-15.00</th></tr></thead><tbody id='smAbsentBody'></tbody></table></div><div class='table-responsive col-sm-3'><table class='table table-hover table-bordered'><thead><tr><th class='success text-center' style='font-size:2em'>\u0E40\u0E1E\u0E34\u0E48\u0E21</th></tr><tr><th class='text-center col-sm-6'>DATE</th></tr></thead><tbody id='smPresentBody'></tbody></table></div></div>"),$(".typeahead").change(function(){let c=$(".typeahead").typeahead("getActive");$("#smAbsentBody").empty(),$("#smPresentBody").empty(),genPickedTable(c.id)})}).fail(function(){log("=>fail to post/allStudent")})}function genPickedTable(a){let b=moment();$.post("post/listStudentAttendanceModifierByStudent",{studentID:a,start:b.valueOf()}).done(function(c){let d=moment(0);for(let e=0;e<c.modifier.length;e++)if("\u0E40\u0E1E\u0E34\u0E48\u0E21"===c.modifier[e].reason)$("#smPresentBody").append("<tr><td class='text-center'>"+moment(c.modifier[e].day).format("DD/MM/YYYY")+"</td></tr>");else if("\u0E25\u0E32"===c.modifier[e].reason){let f=moment(c.modifier[e].day).date()===d.date()&&moment(c.modifier[e].day).month()===d.month()&&moment(c.modifier[e].day).year()===d.year();f?(8===moment(c.modifier[e].day).hour()&&$(".a:last").html("\u2713"),10===moment(c.modifier[e].day).hour()&&$(".b:last").html("\u2713"),13===moment(c.modifier[e].day).hour()&&$(".c:last").html("\u2713")):(d=moment(c.modifier[e].day),$("#smAbsentBody").append("<tr></tr>"),$("#smAbsentBody tr:last-child").append("<td class='text-center'>"+moment(c.modifier[e].day).format("DD/MM/YYYY")+"</td><td class='text-center a'>"+(8===moment(c.modifier[e].day).hour()?"\u2713":"-")+"</td><td class='text-center b'>"+(10===moment(c.modifier[e].day).hour()?"\u2713":"-")+"</td><td class='text-center c'>"+(13===moment(c.modifier[e].day).hour()?"\u2713":"-")+"</td>"))}}).fail(function(){log("=>fail to post/listStudentAttendanceModifierByStudent")})}function genTableByWeek(){$("#smWeekBody").empty();const a=parseInt($("#weekSelect").val());weekDayRecur(a,a,8)}function weekDayRecur(a,b,c){if(5>b-a){let d=moment(0).date(b).month(summerMonth).year(summerYear).hour(c);$.post("post/listStudentAttendanceModifierByDay",{day:d.valueOf()}).done(function(e){log(e.absence),weekDayGetName(e.absence,0,d,a)})}}function weekDayGetName(a,b,c,d){if(b<a.length)$.post("post/name",{userID:a[b].studentID}).done(function(e){"\u0E25\u0E32"===a[b].reason&&("0"===$("#typeSelect").val()||"1"===$("#typeSelect").val())?($("#smWeekBody").append("<tr class='danger'></tr>"),$("#smWeekBody tr:last-child").append("<td class='text-center'>"+a[b].studentID+"</td><td>"+e.firstname+" ("+e.nickname+") "+e.lastname+"</td><td class='text-center'>"+c.format("DD/MM/YYYY")+"</td><td class='text-center'>"+c.format("HH:mm")+"</td>")):"\u0E40\u0E1E\u0E34\u0E48\u0E21"===a[b].reason&&("0"===$("#typeSelect").val()||"2"===$("#typeSelect").val())&&($("#smWeekBody").append("<tr class='success'></tr>"),$("#smWeekBody tr:last-child").append("<td class='text-center'>"+a[b].studentID+"</td><td>"+e.firstname+" ("+e.nickname+") "+e.lastname+"</td><td class='text-center'>"+c.format("DD/MM/YYYY")+"</td><td class='text-center'>"+c.format("HH:mm")+"</td>")),log(d),weekDayGetName(a,b+1,c,d)});else{let e=c.hour(),f=c.date();8===e?weekDayRecur(d,f,10):10===e?weekDayRecur(d,f,13):13===e?weekDayRecur(d,f,15):15===e&&weekDayRecur(d,f+1,8)}}