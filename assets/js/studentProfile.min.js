const dayOfWeek=["btn-sun","btn-mon","btn-tue","btn-wed","btn-thu","btn-fri","btn-sat"];$(document).ready(function(){let a=getCookieDict(),b=a.monkeyWebUser;showProfilePic(b),$.post("post/listQuarter",{status:"public"},function(c){let d=[];for(let e=0;e<c.quarter.length;e++)c.quarter[e].quarter===quarter?d.unshift(c.quarter[e]):d.push(c.quarter[e]);for(let e in d)$("#qList").append("<option>"+d[e].name+" - "+d[e].quarter+"</option>");fillData(b),$("#qList").val().slice($("#qList").val().indexOf("-")+2)==summerQuarter?($("#crTable").collapse("hide"),$("#smTable").collapse("show")):($("#crTable").collapse("show"),$("#smTable").collapse("hide"))}),$("#qList").change(function(){fillData(b),$("#qList").val().slice($("#qList").val().indexOf("-")+2)==summerQuarter?($("#crTable").collapse("hide"),$("#smTable").collapse("show")):($("#crTable").collapse("show"),$("#smTable").collapse("hide"))}),$(".profilePic").click(function(){$("#profileModal").modal()})});function fillData(a){$.post("post/studentProfile",{studentID:a},function(b){$("#id").html(a),$("#name").html(b.firstname+" ("+b.nickname+") "+b.lastname),$("#nameE").html(b.firstnameEn+" ("+b.nicknameEn+") "+b.lastnameEn),$("#grade").html(6<b.grade?"\u0E21."+(b.grade-6):"\u0E1B."+b.grade),$("#parentTel").html(b.phoneParent),$("#studentTel").html(b.phone),$("#email").html(b.email);let c=!0;if(0<b.quarter.length)for(let d=0;d<b.quarter.length;d++)b.quarter[d].quarter==$("#qList").val().slice($("#qList").val().indexOf("-")+2)&&($("#status").html(b.quarter[d].registrationState),c=!1);c&&$("#status").html("\u0E22\u0E31\u0E07\u0E44\u0E21\u0E48\u0E44\u0E14\u0E49\u0E25\u0E07\u0E17\u0E30\u0E40\u0E1A\u0E35\u0E22\u0E19"),$(".btn-default").removeClass("hb cr sk").html("&nbsp;"),fillTableCr(b.courseID,0),$("#qList").val().slice($("#qList").val().indexOf("-")+2)!=summerQuarter&&3!=$("#qList").val().slice($("#qList").val().indexOf("-")+2)&&(fillTableFhb(a),fillTableSk(a))})}function showProfilePic(a){$.post("post/getConfig").then(c=>{let d=c.profilePicturePath.slice(c.profilePicturePath.search("MonkeyWebData")+14)+a;$.get(d+".jpg").done(function(){$(".profilePic").attr("src",d+".jpg")}).fail(function(){$.get(d+".jpeg").done(function(){$(".profilePic").attr("src",d+".jpeg")}).fail(function(){$.get(d+".png").done(function(){$(".profilePic").attr("src",d+".png")}).fail(function(){log("can't find profile picture")})})})})}function fillTableCr(a,b){b<a.length&&$.post("post/courseInfo",{courseID:a[b]},function(c){if(c.quarter==$("#qList").val().slice($("#qList").val().indexOf("-")+2)){let d=moment(c.day).hour(),e=moment(c.day).day();$.post("post/name",{userID:c.tutor[0]},function(f){"Hybrid"===f.nicknameEn?$("."+dayOfWeek[e]+"-"+d).html(c.courseName+" (HB)").addClass("cr"):$("."+dayOfWeek[e]+"-"+d).html(c.courseName+" ("+f.nicknameEn+")").addClass("cr"),fillTableCr(a,b+1)})}fillTableCr(a,b+1)})}function fillTableFhb(a){let b=$("#qList").val().slice($("#qList").val().indexOf("-")+2);$.post("post/v1/listStudentHybrid",{year:year,quarter:b,studentID:a},function(c){for(let d=0;d<c.length;d++){let e=moment(c[d].day).hour(),f=moment(c[d].day).day();$("."+dayOfWeek[f]+"-"+e).html("FHB: "+c[d].subject).addClass("hb")}})}function fillTableSk(a){let b=$("#qList").val().slice($("#qList").val().indexOf("-")+2);$.post("post/v1/listStudentSkill",{year:year,quarter:b,studentID:a},function(c){log(c);for(let d=0;d<c.length;d++){let e=moment(c[d].day).hour(),f=moment(c[d].day).day();$("."+dayOfWeek[f]+"-"+skillTime(e)).html("SKILL: "+c[d].subject+" ("+moment(c[d].day).format("HH:mm")+")").addClass("sk")}})}function skillTime(a){switch(a){case 9:return 8;break;case 11:return 10;break;case 14:return 13;break;case 16:return 15;break;default:return a;}}function upPic(){let a=getCookieDict(),b=a.monkeyWebUser,c=$("#file-1"),d=c.val().split(".").pop().toLowerCase();if(-1===$.inArray(d,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let e=c.get(0).files,f=new FormData;f.append("file",e[0],e[0].name),f.append("userID",b),$.ajax({url:"post/updateProfilePicture",type:"POST",data:f,processData:!1,contentType:!1,success:function(){$("#profileModal").modal("hide"),location.reload()}})}}