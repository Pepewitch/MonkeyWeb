let genTableData=(()=>{var a=_asyncToGenerator(function*(){let b,c=$("#interval-select"),d=$("#interval-select option:selected").attr("id"),e=moment(c.val().slice(0,9),"DD MMM YY").hour(0).minute(0).second(0).millisecond(0).valueOf(),f=moment(c.val().slice(12,21),"DD MMM YY").hour(23).minute(59).second(59).millisecond(0).valueOf(),[g,h]=yield Promise.all([$.post("post/v1/listInterval"),$.post("post/v1/listAllCheckInHistory",{startDate:e,endDate:f})]);for(let q in g)g[q].intervalID===d&&(b=g[q].multiplier);let k=$("#mainTableBody");k.empty();let l=[],m=[];for(let q in h)l.push(name(q)),m.push($.post("post/v1/listExtra",{intervalID:d,tutorID:q}));let n=yield Promise.all(l),o=yield Promise.all(m),p=0;for(let q in h){let r=1;b!==void 0&&b[q]!==void 0&&(r=b[q]);let s=o[p],t=0,u="",v="";for(let w=0;w<s.length;w++)t+=s[w].value,0<=s[w].reason.indexOf("FPGG")&&(u=s[w].reason.slice(4),v=s[w].extraID);k.append("<tr><td class='text-center'>"+q+"</td><td class='text-center table-info' onclick='showTutorHistory("+q+")'>"+n[p].nickname+" "+n[p].firstname+"</td><td class='text-center table-primary' onclick='manageFirstpage(\""+v+"\","+q+")'>"+u+"</td><td class='text-center'>"+h[q].hourSum.toFixed(1)+"</td><td class='text-center'>"+h[q].totalSum.toFixed(1)+"</td><td class='text-center table-info' onclick='callEditGainModal("+q+")'>"+r+"</td><td class='text-center'>"+(h[q].totalSum*r).toFixed(0)+"</td><td class='text-center'>"+t+"</td><td class='text-center'>"+(parseInt((h[q].totalSum*r).toFixed(0))+t)+"</td></tr>"),p+=1}});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),k=h.value}catch(l){return void d(l)}return h.done?void c(k):Promise.resolve(k).then(function(l){e("next",l)},function(l){e("throw",l)})}return e("next")})}}genIntervalSelectOption();function genIntervalSelectOption(){$.post("post/v1/listInterval").then(a=>{let b=$("#interval-select");for(let c in a){let d=moment(a[c].startDate),e=moment(a[c].endDate);b.append("<option id="+a[c].intervalID+">"+d.format("DD MMM YY")+" - "+e.format("DD MMM YY")+"</option>")}genTableData()})}$("#addIntervalButt").click(function(){$("#addIntervalModal").modal("show")}),$("#addIntervalStart").datetimepicker({format:"DD/MM/YYYY"}),$("#addIntervalEnd").datetimepicker({format:"DD/MM/YYYY"}),$("#addIntervalSubmitButt").click(function(){""===$("#addIntervalStart").val()?alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E27\u0E31\u0E19\u0E40\u0E23\u0E34\u0E48\u0E21\u0E15\u0E49\u0E19"):""===$("#addIntervalEnd").val()?alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E27\u0E31\u0E19\u0E2A\u0E34\u0E49\u0E19\u0E2A\u0E38\u0E14"):submitAddIntervalData()});function submitAddIntervalData(){let a=$("#addIntervalStart").data("DateTimePicker").date().hour(0).minute(0).second(0).millisecond(0),b=$("#addIntervalEnd").data("DateTimePicker").date().hour(23).minute(59).second(59).millisecond(0);a.valueOf()>=b.valueOf()?alert("\u0E27\u0E31\u0E19\u0E40\u0E23\u0E34\u0E48\u0E21\u0E15\u0E49\u0E19\u0E15\u0E49\u0E2D\u0E07\u0E2D\u0E22\u0E39\u0E48\u0E01\u0E48\u0E2D\u0E19\u0E27\u0E31\u0E19\u0E08\u0E1A"):$.post("post/v1/addCheckInterval",{startDate:a.valueOf(),endDate:b.valueOf()}).then(c=>{log(c),location.reload()})}$("#editIntervalButt").click(function(){let a=$("#interval-select"),b=moment(a.val().slice(0,9),"DD MMM YY"),c=moment(a.val().slice(12,21),"DD MMM YY");$("#editIntervalStart").attr("placeholder",b.format("DD/MM/YYYY")),$("#editIntervalEnd").attr("placeholder",c.format("DD/MM/YYYY")),$("#editIntervalModal").modal("show")}),$("#editIntervalStart").datetimepicker({format:"DD/MM/YYYY"}),$("#editIntervalEnd").datetimepicker({format:"DD/MM/YYYY"}),$("#editIntervalSubmitButt").click(function(){submitEditIntervalData()}),$("#editIntervalRemoveButt").click(function(){if(confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E0A\u0E48\u0E27\u0E07\u0E40\u0E27\u0E25\u0E32\u0E19\u0E35\u0E49?")){let a=$("#interval-select option:selected").attr("id");$.post("post/v1/deleteInterval",{intervalID:a}).then(b=>{log("Complete to remove interval => "+b),location.reload()})}});function submitEditIntervalData(){let a=$("#interval-select"),b=a.find(":selected").attr("id"),c={intervalID:b};""!==$("#editIntervalStart").val()&&(c.startDate=$("#editIntervalStart").data("DateTimePicker").date().hour(0).minute(0).second(0).millisecond(0).valueOf()),""!==$("#editIntervalEnd").val()&&(c.endDate=$("#editIntervalEnd").data("DateTimePicker").date().hour(23).minute(59).second(59).millisecond(0).valueOf()),$.post("post/v1/editInterval",c).then(d=>{log(d),location.reload()})}$("#interval-select").change(function(){genTableData()});function callEditGainModal(a){$("#editGainModalTitle").html("Edit "+a+" gain"),$("#editGainModal").modal("show")}$("#editGainSubmitButt").click(function(){editGain()});function editGain(){let a=$("#interval-select option:selected").attr("id"),b=$("#editGainModalTitle").html().slice(5,10);""===$("#editGainValue").val()?alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E01\u0E23\u0E2D\u0E01\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25"):$.post("post/v1/editInterval",{intervalID:a,multiplier:{tutorID:b,value:$("#editGainValue").val()}}).then(c=>{log("Complete to edit multiplier => "+c),genTableData(),$("#editGainModal").modal("hide")})}function manageFirstpage(a,b){writeCookie("tempFpID",a),writeCookie("tempttID",b),$("#fpReasonModal").modal("show")}$("#fpReasonAddSubmitButt").click(function(){let a=$("#interval-select option:selected").attr("id"),b=getCookieDict();b.tempFpID!==void 0&&(""===$("#fpReasonAdd").val()?alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E01\u0E23\u0E2D\u0E01\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25"):""===b.tempFpID?$.post("post/v1/addExtra",{intervalID:a,tutorID:b.tempttID,value:0,reason:"FPGG"+$("#fpReasonAdd").val()}).then(c=>{$("#fpReasonModal").modal("hide"),log("Complete to add extra => "+c),deleteCookie("tempFpID"),deleteCookie("tempttID"),genTableData()}):$.post("post/v1/removeExtra",{extraID:b.tempFpID}).then(c=>{log("Complete to remove extra => "+c),$.post("post/v1/addExtra",{intervalID:a,tutorID:b.tempttID,value:0,reason:"FPGG"+$("#fpReasonAdd").val()}).then(d=>{$("#fpReasonModal").modal("hide"),log("Complete to add extra => "+d),deleteCookie("tempFpID"),deleteCookie("tempttID"),genTableData()})}))}),$("#fpReasonRmSubmitButt").click(function(){let a=getCookieDict();""===a.tempFpID?alert("\u0E44\u0E21\u0E48\u0E21\u0E35\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E43\u0E19\u0E40\u0E0B\u0E25\u0E25\u0E4C\u0E19\u0E35\u0E49"):$.post("post/v1/removeExtra",{extraID:a.tempFpID}).then(b=>{deleteCookie("tempFpID"),$("#fpReasonModal").modal("hide"),log("Complete to remove extra => "+b),genTableData()})});function showTutorHistory(a){let b=$("#tutorHistoryModal"),c=$("#tutorHistoryModalTitle"),d=$("#tutorHistoryModalTable"),e=$("#interval-select"),f=moment(e.val().slice(0,9),"DD MMM YY").hour(0).minute(0).second(0).millisecond(0).valueOf(),g=moment(e.val().slice(12,21),"DD MMM YY").hour(23).minute(59).second(59).millisecond(0).valueOf();$.post("post/v1/listCheckInHistory",{tutorID:a,startDate:f,endDate:g}).then(h=>{for(let k in d.empty(),h.detail){let l=moment(h.detail[k].checkIn),m=moment(h.detail[k].checkOut),n=0,o=m.hour()-l.hour()+(m.minute()-l.minute())/60;0<=h.detail[k].sum&&(n=h.detail[k].sum),d.append("<tr><td class='text-center'>"+l.format("ddd")+"</td><td class='text-center'>"+l.format("DD MMM YYYY")+"</td><td class='text-center' onclick='editCheckIO(\""+h.detail[k].historyID+"\",\""+h.detail[k].checkIn+"\")'>"+l.format("HH:mm")+"</td><td class='text-center' onclick='editCheckIO(\""+h.detail[k].historyID+"\",\""+h.detail[k].checkIn+"\")'>"+m.format("HH:mm")+"</td><td>"+detailButton(h.detail[k].detail,h.detail[k].historyID)+"</td><td class='text-center'>"+n.toFixed(1)+"</td><td class='text-center'>"+o.toFixed(1)+"</td><td>"+trashButton(a+"",h.detail[k].historyID)+"</td></tr>")}c.html(a),b.modal("show")}),showExtra(a)}const detailButton=(a,b)=>{let c="";return c+="<button class='btn btn-light col-2 btn-"+buttonMinText(a[0])+"' onclick='editIOHistorySlot(\""+b+"\",\""+a+"\",0)'>"+buttonMinText(a[0])+"</button>",c+="<button class='btn btn-light col-2 btn-"+buttonMinText(a[1])+"' onclick='editIOHistorySlot(\""+b+"\",\""+a+"\",1)'>"+buttonMinText(a[1])+"</button>",c+="<button class='btn btn-light col-2 btn-"+buttonMinText(a[2])+"' onclick='editIOHistorySlot(\""+b+"\",\""+a+"\",2)'>"+buttonMinText(a[2])+"</button>",c+="<button class='btn btn-light col-2 btn-"+buttonMinText(a[3])+"' onclick='editIOHistorySlot(\""+b+"\",\""+a+"\",3)'>"+buttonMinText(a[3])+"</button>",c+="<button class='btn btn-light col-2 btn-"+buttonMinText(a[4])+"' onclick='editIOHistorySlot(\""+b+"\",\""+a+"\",4)'>"+buttonMinText(a[4])+"</button>",c+="<button class='btn btn-light col-2 btn-"+buttonMinText(a[5])+"' onclick='editIOHistorySlot(\""+b+"\",\""+a+"\",5)'>"+buttonMinText(a[5])+"</button>",c},buttonMinText=a=>{switch(a){case"Hybrid":a="HB";break;case"Reading":a="Read";break;default:}return a},trashButton=(a,b)=>{return"<button type='button' class='col btn btn-light' onclick='removeIOHistory(\""+a+"\",\""+b+"\")'><span class='fa fa-lg fa-trash-o' style='color: red'></span></button>"};function addExtra(){$("#addExtraModal").modal("show")}function showExtra(a){let b=$("#interval-select option:selected").attr("id");$.post("post/v1/listExtra",{tutorID:a,intervalID:b}).then(c=>{if($("#independentExtra").empty(),0!==c.length)for(let d in $("#independentExtra").append("<h4 onclick='addExtra()'>Extra</h4>"),c)0>c[d].reason.indexOf("FPGG")&&$("#independentExtra").append("<h4>"+c[d].reason+" : "+c[d].value+" <span class='fa fa-trash' style='color:red' onclick='removeExtra(\""+c[d].extraID+"\")'></span></h4>");else $("#independentExtra").append("<button class='btn btn-light' onclick='addExtra()'>+ Add extra</button>")})}function removeExtra(a){if(confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A Extra \u0E19\u0E35\u0E49?")){let b=$("#tutorHistoryModalTitle").html();$.post("post/v1/removeExtra",{extraID:a}).then(c=>{log("Complete to remove extra => "+c),showTutorHistory(b),genTableData()})}}$("#addExtraSubmitButt").click(function(){if(""===$("#addExtraValue").val())alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E15\u0E31\u0E27\u0E40\u0E25\u0E02");else if(""===$("#addExtraReason").val())alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E43\u0E2A\u0E48\u0E40\u0E2B\u0E15\u0E38\u0E1C\u0E25");else{let a=$("#interval-select option:selected").attr("id"),b=$("#tutorHistoryModalTitle").html();$.post("post/v1/addExtra",{intervalID:a,tutorID:b,value:$("#addExtraValue").val(),reason:$("#addExtraReason").val()}).then(c=>{log("Complete to add extra => "+c),$("#addExtraModal").modal("hide"),showTutorHistory(b),genTableData()})}}),$("#editTutorHistoryIn").datetimepicker({format:"HH:mm"}),$("#editTutorHistoryOut").datetimepicker({format:"HH:mm"});function editCheckIO(a,b){writeCookie("tempHistoryID",a),writeCookie("tempHistoryDate",b),$("#editTutorHistoryIn").val(""),$("#editTutorHistoryOut").val(""),$("#checkIOTimeHistoryModal").modal("show")}$("#editTutorHistorySubmitButt").click(function(){editIOHistoryTime()});function editIOHistoryTime(){let a=$("#tutorHistoryModalTitle").html(),b=getCookieDict(),c={};if(b.tempHistoryID===void 0||b.tempHistoryDate===void 0)alert("\u0E40\u0E01\u0E34\u0E14\u0E02\u0E49\u0E2D\u0E1C\u0E34\u0E14\u0E1E\u0E25\u0E32\u0E14 \u0E01\u0E23\u0E38\u0E13\u0E32\u0E25\u0E2D\u0E07\u0E43\u0E2B\u0E21\u0E48\u0E2D\u0E35\u0E01\u0E04\u0E23\u0E31\u0E49\u0E07"),$("#checkIOTimeHistoryModal").modal("hide");else{c.historyID=b.tempHistoryID;let d=moment(parseInt(b.tempHistoryDate)),e=$("#editTutorHistoryIn").val(),f=$("#editTutorHistoryOut").val();if(""===e&&""===f)alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E01\u0E23\u0E2D\u0E01\u0E40\u0E27\u0E25\u0E32\u0E17\u0E35\u0E48\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E41\u0E01\u0E49\u0E44\u0E02");else{if(""!==e){let g=$("#editTutorHistoryIn").data("DateTimePicker").date();c.checkIn=d.hour(g.hour()).minute(g.minute()).valueOf()}if(""!==f){let g=$("#editTutorHistoryOut").data("DateTimePicker").date();c.checkOut=d.hour(g.hour()).minute(g.minute()).valueOf()}$.post("post/v1/editCheckOutHistory",c).then(g=>{log("Edit history complete => "+g),$("#checkIOTimeHistoryModal").modal("hide"),showTutorHistory(a),deleteCookie("tempHistoryID"),deleteCookie("tempHistoryDate")})}}}function editIOHistorySlot(a,b,c){writeCookie("tempEditHistoryID",a),writeCookie("tempEditDetail",b),writeCookie("tempEditIndex",c),$("#checkIOSlotModal").modal("show")}$("#checkIOSlotModal .selector").click(function(){let a=getCookieDict(),b=a.tempEditHistoryID,c=a.tempEditDetail,d=a.tempEditIndex,e={};e.historyID=b;let f=$("#tutorHistoryModalTitle").html(),g=$(this).html(),h=[0,0,0,0,0,0];convertStrToIntArray(h,c,0),h[d]=getSlotValue(g),e.slot=h,$.post("post/v1/editCheckOutHistory",e).then(k=>{log("Edit history complete => "+k),$("#checkIOSlotModal").modal("hide"),showTutorHistory(f),deleteCookie("tempEditHistoryID"),deleteCookie("tempEditDetail"),deleteCookie("tempEditIndex")})});const getSlotValue=a=>{let b=-1;switch(a){case"Hybrid":b=0;break;case"Admin":b=1;break;case"Sheet":b=2;break;case"Com":b=3;break;case"Reading":b=4;break;case"Course":b=5;break;default:b=-1;}return b},convertStrToIntArray=(a,b,c)=>{6>c&&(a[c]=getSlotValue(b.slice(0,b.indexOf(","))),convertStrToIntArray(a,b.slice(b.indexOf(",")+1),c+1))};function removeIOHistory(a,b){let c=$("#tutorHistoryModalTable");c.modal("hide"),confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E1B\u0E23\u0E30\u0E27\u0E31\u0E15\u0E34\u0E19\u0E35\u0E49?")&&$.post("post/v1/deleteCheckOutHistory",{historyID:b}).then(d=>{log("Complete to delete history=>"+d),showTutorHistory(a)})}$("#addTutorHistoryDate").datetimepicker({format:"DD/MM/YYYY"}),$("#addTutorHistoryIn").datetimepicker({format:"HH:mm"}),$("#addTutorHistoryOut").datetimepicker({format:"HH:mm"}),$("#addHistoryButt").click(function(){$("#addHistoryModal").modal("show")}),$("#addTutorHistorySubmitButt").click(function(){""===$("#addTutorHistoryDate").val()||""===$("#addTutorHistoryIn").val()||""===$("#addTutorHistoryOut")?alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E01\u0E23\u0E2D\u0E01\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E43\u0E2B\u0E49\u0E04\u0E23\u0E1A\u0E16\u0E49\u0E27\u0E19"):confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21\u0E1B\u0E23\u0E30\u0E27\u0E31\u0E15\u0E34?")&&(addIOHistory(),$("#addHistoryModal").modal("hide"))});function addIOHistory(){let a=$("#tutorHistoryModalTitle").html(),b=$("#addTutorHistoryDate").data("DateTimePicker").date(),c=$("#addTutorHistoryIn").data("DateTimePicker").date(),d=$("#addTutorHistoryOut").data("DateTimePicker").date(),e=moment(0).date(b.date()).month(b.month()).year(b.year()).hour(c.hour()).minute(c.minute()),f=moment(0).date(b.date()).month(b.month()).year(b.year()).hour(d.hour()).minute(d.minute()),g=[$("#addHistorySlot8").val(),$("#addHistorySlot10").val(),$("#addHistorySlot13").val(),$("#addHistorySlot15").val(),$("#addHistorySlot17").val(),$("#addHistorySlot19").val()];$.post("post/v1/addCheckOutHistory",{tutorID:a,checkIn:e.valueOf(),checkOut:f.valueOf(),slot:g}).then(h=>{log("Add new history => "+h),showTutorHistory(a)})}