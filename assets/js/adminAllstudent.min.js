var studentForSearch=[];const getLetterGrade=a=>{return 6>=a?"P"+a:"S"+(a-6)},getDateName=a=>{return["SUN","MON","TUE","WED","THU","FRI","SAT"][a]};$(function(){log($(document).width()),767<$(document).width()&&$("#filterPanel").addClass("position-fixed"),getAllStudentContent()});function quarterChange(){var a=document.getElementById("quarter");writeCookie("monkeyWebSelectedQuarter",a.options[a.selectedIndex].value),getAllStudentContent()}function registrationStateChange(){var a=document.getElementById("stage");writeCookie("monkeyWebSelectedStage",a.value),getAllStudentContent()}function getAllStudentContent(){getConfig().then(a=>{document.getElementById("currentStudentLabel").innerHTML="Current Student: "+(a.nextStudentID-1),loadSelectedMenu(a),studentForSearch=[],allStudent().then(b=>{if(b.err)log("[getAllStudentContent()] : post/allStudent => "+b.err);else{log("[getAllStudentContent()] : post/allStudent => "),log(b);for(let c=0;c<b.student.length;c++)studentForSearch.push({name:b.student[c].nickname+" "+b.student[c].firstname,id:b.student[c].studentID});$(".typeahead").typeahead({source:studentForSearch,autoSelect:!0}),$(".typeahead").change(function(){let c=$(".typeahead").typeahead("getActive");c&&(writeCookie("monkeyWebAdminAllstudentSelectedUser",c.id),self.location="/adminStudentprofileQ4")}),position(getCookieDict().monkeyWebUser).then(c=>{var d="public";switch(c.position){case"tutor":case"admin":d="protected";break;case"dev":d="private";}listQuarter(d).then(e=>{generateStudentHtmlTable(filterData(b.student,e,a))})})}})})}function loadSelectedMenu(a){var b=document.getElementById("stage"),c=getCookieDict(),d=[{value:"all",text:"No filter"},{value:"allStage",text:"All Stage"},{value:"unregistered",text:"Unregistered"},{value:"untransferred",text:"Untransferred"},{value:"transferred",text:"Transferred"},{value:"approved",text:"Approved"},{value:"rejected",text:"Rejected"},{value:"pending",text:"Pending"},{value:"finished",text:"Finished"}];b.innerHTML="";for(let g=0;g<d.length;g++)b.innerHTML+="<option value = '"+d[g].value+"'>"+d[g].text+"</option>";b.value=void 0===c.monkeyWebSelectedStage?"all":c.monkeyWebSelectedStage;var e=document.getElementById("quarter");e.innerHTML="";let f="";position(c.monkeyWebUser).then(g=>{switch(g.position){case"tutor":case"admin":f="protected";break;case"dev":f="private";}listQuarter(f).then(h=>{for(let j=0;j<h.quarter.length;j++)e.innerHTML+="<option value = '"+h.quarter[j].year+"-"+h.quarter[j].quarter+"'>"+h.quarter[j].name+"</option>";e.value=void 0===c.monkeyWebSelectedQuarter?a.defaultQuarter.quarter.year+"-"+a.defaultQuarter.quarter.quarter:c.monkeyWebSelectedQuarter})})}function filterData(a,b,c){let d=document.getElementById("quarter"),e=document.getElementById("status"),f=document.getElementById("stage"),g=document.getElementById("grade"),h=document.getElementById("course");var j=getCookieDict();void 0===j.monkeyWebSelectedQuarter&&(j.monkeyWebSelectedQuarter=c.defaultQuarter.quarter.year+"-"+c.defaultQuarter.quarter.quarter);let k=parseInt(j.monkeyWebSelectedQuarter.substring(0,j.monkeyWebSelectedQuarter.indexOf("-"))),l=parseInt(j.monkeyWebSelectedQuarter.substring(j.monkeyWebSelectedQuarter.indexOf("-")+1));return a=a.filter(m=>{if("all"!==f.options[f.selectedIndex].value){var n="unregistered";for(let o=0;o<m.quarter.length;o++)(k=m.quarter[o].year&&l===m.quarter[o].quarter)&&(n=m.quarter[o].registrationState);return"allStage"===f.options[f.selectedIndex].value&&"unregistered"!==n||f.options[f.selectedIndex].value===n}return!0}),"all"!==e.options[e.selectedIndex].value&&(a=a.filter(m=>{return m.status===e.options[e.selectedIndex].value})),"all"!==g.options[g.selectedIndex].value&&(a=a.filter(m=>m.grade===parseInt(g.options[g.selectedIndex].value))),"all"!==h.options[h.selectedIndex].value&&(a=a.filter(m=>{switch(h.options[h.selectedIndex].value){case"hb":return m.inHybrid;case"cr":return m.inCourse;default:}})),a}function generateStudentHtmlTable(a){let b=document.getElementById("allStudentTable");b.innerHTML="";for(let c=0;c<a.length;c++){let d=b.insertRow(c),e=a[c].status,f=a[c].registrationState;"terminated"===e?d.setAttribute("class","danger"):"dropped"===e?d.setAttribute("class","warning"):"inactive"===e?d.setAttribute("class","info"):void 0;"finished"===f&&d.setAttribute("class","success");let g=d.insertCell(0),h=d.insertCell(1),j=d.insertCell(2),k=d.insertCell(3),l=d.insertCell(4),m=d.insertCell(5),n=d.insertCell(6);g.innerHTML="<td>"+(c+1)+"</td>",h.innerHTML="<td>"+a[c].studentID+"</td>",j.innerHTML="<td>"+getLetterGrade(a[c].grade)+"</td>",k.innerHTML="<td>"+a[c].nickname+"</td>",l.innerHTML="<td>"+a[c].firstname+"</td>",m.innerHTML="<td>"+a[c].lastname+"</td>",n.innerHTML="<td>"+a[c].level+"</td>";d.onclick=(p=>()=>{writeCookie("monkeyWebAdminAllstudentSelectedUser",p.getElementsByTagName("td")[1].innerHTML),self.location="/adminStudentprofileQ4"})(d)}}function scanStudentBarcode(){let a=document.getElementById("studentID");writeCookie("monkeyWebAdminAllstudentSelectedUser",a.value.substring(0,a.value.length-1)),self.location="/adminStudentprofileQ4"}function createNewStudent(){$.post("/post/addBlankStudent",{number:1}).then(a=>{log(a),document.getElementById("newStudentUsername").innerHTML="Username: "+a.student[0].studentID,document.getElementById("newStudentPassword").innerHTML="Password: "+a.student[0].password,$("#newStudentDialog").modal({backdrop:"static",keyboard:!1})})}function closeNewStudentDialog(){$("#newStudentDialog").modal("hide"),location.reload()}