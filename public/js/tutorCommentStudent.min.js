$(document).ready(function(){var a=[];$.post("post/allStudent").then(e=>{for(let f=0;f<e.student.length;f++)"active"===e.student[f].status&&a.push(e.student[f].nickname+" "+e.student[f].firstname+"("+e.student[f].studentID+")");$("#search-box .typeahead").typeahead({source:a})});let b=getCookieDict(),c=b.monkeyWebUser,d;writeCookie("commIndex",0),b=getCookieDict(),$.post("post/position",{userID:c}).then(e=>{d=e.position,writeCookie("pos",d),showComment(d,parseInt(b.commIndex))}),$("#postButton").click(function(){let e=$("#search-box .typeahead").typeahead("getActive"),f=$("#comment").val();e===void 0?alert("Please Input Student Name"):7<e.length?$.post("post/addStudentComment",{studentID:e.slice(-6,-1),tutorID:c,message:$("#comment").val()},function(){location.reload()}):alert("Please Select Correct Name")})});function showComment(a,b){$.post("post/listStudentCommentByIndex",{start:b,limit:10}).then(c=>{$("#commentList").empty(),"tutor"===a?getName(c,0):getNameAdmin(c,0),10>c.comment.length?$(".next").hide():$(".next").show(),0===parseInt(b)?$(".previous").hide():$(".previous").show()})}function getName(a,b){log("======recur======:"+b),$.post("post/name",{userID:a.comment[b].tutorID}).then(c=>{$.post("post/name",{userID:a.comment[b].studentID}).then(d=>{let e=moment(a.comment[b].timestamp,"x").format("DD MMM");0<a.comment[b].priority?($("#commentList").append("<h4><span class='glyphicon glyphicon-pushpin' style='color:red'></span> "+c.nickname+" -> "+d.nickname+" "+d.firstname+" ("+e+")</h4>"),$("#commentList").append("<p>"+a.comment[b].message+"</p>")):($("#commentList").append("<h4>"+c.nickname+" -> "+d.nickname+" "+d.firstname+" ("+e+")</h4>"),$("#commentList").append("<p>"+a.comment[b].message+"</p>")),b<a.comment.length-1&&getName(a,b+1)})})}function getNameAdmin(a,b){log("======recur======:"+b),$.post("post/name",{userID:a.comment[b].tutorID}).then(c=>{$.post("post/name",{userID:a.comment[b].studentID}).then(d=>{let e=moment(a.comment[b].timestamp,"x").format("DD MMM");0<a.comment[b].priority?($("#commentList").append("<div class='dropdown'></div>"),$(".dropdown:last-child").append("<h4 class='dropdown-toggle' data-toggle='dropdown'><span class='glyphicon glyphicon-pushpin' style='color:red'></span> "+c.nickname+" -> "+d.nickname+" "+d.firstname+" ("+e+") <span class='glyphicon glyphicon-option-vertical'></span></h4>"),$(".dropdown:last-child").append("<ul class='dropdown-menu'><li><a onClick='addPin(\""+a.comment[b].commentID+"\")'>PIN</a></li><li><a onClick='rmPin(\""+a.comment[b].commentID+"\")'>UNPIN</a></li><li><a onClick='rmComm(\""+a.comment[b].commentID+"\")'>REMOVE</a></li></ul>"),$("#commentList").append("<p>"+a.comment[b].message+"</p>")):($("#commentList").append("<div class='dropdown'></div>"),$(".dropdown:last-child").append("<h4 class='dropdown-toggle' data-toggle='dropdown'>"+c.nickname+" -> "+d.nickname+" "+d.firstname+" ("+e+") <span class='glyphicon glyphicon-option-vertical'></span></h4>"),$(".dropdown:last-child").append("<ul class='dropdown-menu'><li><a onClick='addPin(\""+a.comment[b].commentID+"\")'>PIN</a></li><li><a onClick='rmPin(\""+a.comment[b].commentID+"\")'>UNPIN</a></li><li><a onClick='rmComm(\""+a.comment[b].commentID+"\")'>REMOVE</a></li></ul>"),$("#commentList").append("<p>"+a.comment[b].message+"</p>")),b<a.comment.length-1&&getNameAdmin(a,b+1)})})}function commPosition(a){let b=getCookieDict(),c;0<a?(c=parseInt(b.commIndex)+10,writeCookie("commIndex",c)):(c=parseInt(b.commIndex)-10,writeCookie("commIndex",c));let d=b.pos;showComment(d,c)}function addPin(a){let b=getCookieDict(),c=b.pos;$.post("post/changeStudentCommentPriority",{commentID:a,priority:1}).then(()=>{showComment(c,parseInt(b.commIndex))})}function rmPin(a){let b=getCookieDict(),c=b.pos;$.post("post/changeStudentCommentPriority",{commentID:a,priority:0}).then(()=>{showComment(c,parseInt(b.commIndex))})}function rmComm(a){let b=getCookieDict(),c=b.pos;$.post("post/removeStudentComment",{commentID:a}).then(()=>{showComment(c,parseInt(b.commIndex))})}